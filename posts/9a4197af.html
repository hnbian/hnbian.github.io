<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="基于centos6.5部署 Cloudstack, hnbian">
    <meta name="description" content="1. 前言CloudStack是一个功能强大、UI友好的开源云（IaaS）计算解决方案。自Ctrix将CloudStack捐献给Apache 后，一直持续高速发展，其社区活跃度已经渐渐赶上另一开源云OpenStack平台。CloudStac">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155985521-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-155985521-1');
</script>


    <title>基于centos6.5部署 Cloudstack | hnbian</title>
    <link rel="icon" type="image/png" href="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="hnbian" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">hnbian</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB" class="logo-img circle responsive-img">
        
        <div class="logo-name">hnbian</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hnbian" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hnbian" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://images.hnbian.cn/FtCZ7Sexc0fz8T5M1OxlWbgMYWMy')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">基于centos6.5部署 Cloudstack</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/cloudstack/">
                                <span class="chip bg-color">cloudstack</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/others/" class="post-category">
                                others
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2015-11-27
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>CloudStack是一个功能强大、UI友好的开源云（IaaS）计算解决方案。自Ctrix将CloudStack捐献给Apache 后，一直持续高速发展，其社区活跃度已经渐渐赶上另一开源云OpenStack平台。CloudStack拥有所有开源云平台中最为友善的管理界面，而且其天生的多语种支持会使中文用户感觉很爽。</p>
<p>CloudStack可分为管理节点安装和受控节点安装。管理节点安装无特殊要求，完全可以安装到虚拟机环境下。受控节点因要创建虚拟机，故需要硬件虚拟化支持，推荐使用独立主机安装。CloudStack支持多种虚拟化方案，包括：KVM、Xen、XenServer、VMware。因XenServer、VMware已包含有强大的虚拟机管理功能，CloudStack可以直接与其通信调用其管理接口，因此这两种受控机环境下，无需安装任何软件。但KVM、Xen的受控机必须安装 CloudStack-Agent之后，才能被CloudStack管理。</p>
<h2 id="2-前期准备"><a href="#2-前期准备" class="headerlink" title="2. 前期准备"></a>2. 前期准备</h2><p>需要在所有节点上做进行下面的配置</p>
<h3 id="2-1-安装操作系统"><a href="#2-1-安装操作系统" class="headerlink" title="2.1 安装操作系统"></a>2.1 安装操作系统</h3><p>安装CentOS 6.5 minimal，安装后以root用户登录</p>
<h3 id="2-2-配置网络，确保主机能上网"><a href="#2-2-配置网络，确保主机能上网" class="headerlink" title="2.2 配置网络，确保主机能上网"></a>2.2 配置网络，确保主机能上网</h3><ol>
<li>使用vim编辑 ifcfg-eth0 文件</li>
</ol>
<p>evim /etc/sysconfig/network-scripts/ifcfg-eth0</p>
<ol start="2">
<li>修改为如下内容：</li>
</ol>
<table>
<thead>
<tr>
<th>配置项</th>
<th>修改说明</th>
</tr>
</thead>
<tbody><tr>
<td>DEVICE=eth0</td>
<td>[不需要修改]</td>
</tr>
<tr>
<td>HWADDR=52:54:00:B9:A6:C0</td>
<td>[不需要修改]</td>
</tr>
<tr>
<td>NM_CONTROLLED=no</td>
<td>[需要修改]</td>
</tr>
<tr>
<td>ONBOOT=yes</td>
<td>[需要修改]</td>
</tr>
<tr>
<td>BOOTPROTO=none</td>
<td>[需要修改]</td>
</tr>
<tr>
<td>IPADDR=192.168.1.121</td>
<td>[需要修改为你的IP]</td>
</tr>
<tr>
<td>NETMASK=255.255.255.0</td>
<td>[需要修改为你的掩码]</td>
</tr>
<tr>
<td>GATEWAY=192.168.1.1</td>
<td>[需要修改为你的网关]</td>
</tr>
<tr>
<td>DNS1=219.141.136.10</td>
<td>[需要修改为DNS1]</td>
</tr>
<tr>
<td>DNS2=219.141.136.10</td>
<td>[需要修改为DNS2]</td>
</tr>
</tbody></table>
<ol start="3">
<li>运行下面的命令，网络服务进程network配置为开机即启动</li>
</ol>
<p>chkconfig network on </p>
<ol start="4">
<li>运行下面的命令，重启网络服务进程 network</li>
</ol>
<p>service network restart</p>
<ol start="5">
<li>测试网络</li>
</ol>
<p>因我们要使用网络安装方式，所以要首先保证你的服务器可以正常联网。Ping <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a>试试是否可以访问外网。</p>
<h3 id="2-3-设置主机名称"><a href="#2-3-设置主机名称" class="headerlink" title="2.3 设置主机名称"></a>2.3 设置主机名称</h3><p>CloudStack运行时需要获取本机名称，如无法正确获取可能导致服务无法正常启动并报一大堆的错。</p>
<ol>
<li>运行以下命令检查：</li>
</ol>
<p>hostname –fqdn</p>
<ol start="2">
<li>如无正常返回，请编辑 /etc/hosts 文件，添加主机ip对应的名称。</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如：192.168.10.198 manage.cloudstack.com</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改主机名</span></span><br><span class="line"></span><br><span class="line">/etc/sysconfig/network     </span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下</span></span><br><span class="line">Hostname= manage.cloudstack.com</span><br></pre></td></tr></tbody></table></figure>



<ol start="3">
<li>编辑完后立即生效。如果还失败的话，请重启服务器。</li>
</ol>
<h3 id="2-4-修改Linux安全设置"><a href="#2-4-修改Linux安全设置" class="headerlink" title="2.4 修改Linux安全设置"></a>2.4 修改Linux安全设置</h3><p>服务器上的SELinux会拦截CloudStack的一些命令，导致CloudStack操作失败，因此启动CloudStack前需要对SELinux进行设置。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改</span></span><br><span class="line">SELINUX=permissive</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以上修改需重启服务器才能生效，为使设置立即生效可使用下边的命令</span></span><br><span class="line">setenforce permissive</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-5-配置时间同步"><a href="#2-5-配置时间同步" class="headerlink" title="2.5 配置时间同步"></a>2.5 配置时间同步</h3><p>管理节点会通过各种协议与受控节点通讯，为了确保安全，受控节点接到命令后会进行一系列的校验，如果两机的时间不同步的话，会导致命令拒绝执行。最简单的办法就是，所有服务器都安装ntp实现时间的自动同步。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行以下命令安装ntp：</span></span><br><span class="line">yum install ntp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置ntp为开机自启动</span></span><br><span class="line">chkconfig ntpd on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动ntp服务</span></span><br><span class="line">service ntpd start</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-6-更新-yum-仓库"><a href="#2-6-更新-yum-仓库" class="headerlink" title="2.6 更新 yum 仓库"></a>2.6 更新 yum 仓库</h3><p>默认情况下，CentOS的软件源中没有收录最新版本CloudStack，为了能顺利安装，我们需要手工指定软件源。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建 repo 文件</span></span><br><span class="line">vim /etc/yum.repos.d/cloudstack.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加内容为：</span></span><br><span class="line">[cloudstack]</span><br><span class="line">name=cloudstack</span><br><span class="line">baseurl=http://cloudstack.apt-get.eu/rhel/4.4/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></tbody></table></figure>



<h2 id="3-安装数据库"><a href="#3-安装数据库" class="headerlink" title="3. 安装数据库"></a>3. 安装数据库</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server</span><br></pre></td></tr></tbody></table></figure>



<ul>
<li>配置 MySQL</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改连接数 （默认的mysql有连接数限制，无法满足CloudStack管理节点的要求，需要手工设定。</span> </span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在[mysqld]下面添加下列参数增加以下内容：</span></span><br><span class="line"></span><br><span class="line">innodb_rollback_on_timeout=1</span><br><span class="line"></span><br><span class="line">innodb_lock_wait_timeout=600</span><br><span class="line"></span><br><span class="line">max_connections=350</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">binlog-format='ROW'</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注：max_connections的参数应设置350乘以你准备部署的管理节点的数量。这里假定只安装一个管理节点。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 MySQL 服务：</span></span><br><span class="line">service mysqld start</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 MySQL 开机自动启动：</span></span><br><span class="line">chkconfig mysqld on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认安装的MySQL安全级别比较低，需要手工设置MySQL下密码、禁用远程访问，删除无用账户及测试数据库。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法也很简单，直接使用如下命令按向导提示一步步来即可：</span></span><br><span class="line">/bin/systemctl start mysqld.service</span><br><span class="line">systemctl enable mysqld.service</span><br></pre></td></tr></tbody></table></figure>



<ul>
<li>运行mysql 安全配置向导</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">数据库准备好后，需导入CloudStack的表及基础数据，这样云平台才能正常使用：</span></span><br><span class="line">cloudstack-setup-databases cloud:123456@localhost --deploy-as=root:root密码</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果有以下输出表示数据库已经准备完毕</span></span><br><span class="line"></span><br><span class="line">CloudStack has successfully initialized database, you can check your database configuration in /etc/cloudstack/management/db.properties </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="4-cloud-client安装配置"><a href="#4-cloud-client安装配置" class="headerlink" title="4. cloud-client安装配置"></a>4. cloud-client安装配置</h2><h3 id="4-1-安装cloud-client"><a href="#4-1-安装cloud-client" class="headerlink" title="4.1 安装cloud-client"></a>4.1 安装cloud-client</h3><p>设置好源以后，我们就可以直接使用yum安装了，非常简单方便。</p>
<p>安装管理节点的命令为：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install cloud-client</span><br></pre></td></tr></tbody></table></figure>



<p>如果CentOS 是最小化安装的话，将需要安装300兆以上的文件，请耐心等待。如果网速过慢导致下载不了文件而中断安装的话，请重新运行上面的yum命令。</p>
<p>若网速确实慢，有个取巧的办法，从<a target="_blank" rel="noopener" href="http://cloudstack.apt-get.eu/rhel/4.4/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A4%8D%E5%88%B6%E5%88%B0/var/cache/yum/x86_64/6/cloudstack/packages%EF%BC%8C%E6%9B%BF%E6%8D%A2%E6%96%87%E4%BB%B6%EF%BC%8C%E9%87%8D%E6%96%B0%E8%BF%90%E8%A1%8C%E4%B8%8A%E9%9D%A2%E7%9A%84yumy%E5%91%BD%E4%BB%A4%E3%80%82%EF%BC%88%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BB%8E%E7%BD%91%E7%9B%98%E4%B8%8B%E8%BD%BD4.4.3%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E6%96%87%E4%BB%B6http://pan.baidu.com/s/1nt7RtyT%EF%BC%89">http://cloudstack.apt-get.eu/rhel/4.4/下载对应的文件，复制到/var/cache/yum/x86_64/6/cloudstack/packages，替换文件，重新运行上面的yumy命令。（也可以从网盘下载4.4.3版本对应文件http://pan.baidu.com/s/1nt7RtyT）</a></p>
<p>CloudStack使用MySQL管理数据，但安装cloud-client时没有包含MySQL，这时需要我们手工安装，并导入数据。</p>
<h3 id="4-2-修改Tomcat"><a href="#4-2-修改Tomcat" class="headerlink" title="4.2 修改Tomcat"></a>4.2 修改Tomcat</h3><p>由于tomcat为了区分ssl和没有ssl，所以配置分为tomcat6-nonssl.conf和tomcat6-ssl.conf，需要把tomcat6-nonssl.conf更改tomcat6.conf，否则启动会报没有tomcat6.conf文件错误</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换文件夹</span> </span><br><span class="line">cd /etc/cloudstack/management/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改文件名</span> </span><br><span class="line">mv tomcat6-nonssl.conf  tomcat6.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换文件夹</span> </span><br><span class="line">cd /usr/share/cloudstack-management/conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改文件名</span></span><br><span class="line">mv server-nonssl.xml server.xml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注：Tomcat的默认端口是8080，若需要修改成其他端口，则需修改/etc/cloudstack/management/server.xml</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="4-3-安装网络存储"><a href="#4-3-安装网络存储" class="headerlink" title="4.3 安装网络存储"></a>4.3 安装网络存储</h3><p>主存储由于可使用本地存储，故可不添加，但二级存储只能使用网络存储。CloudStack支持多种网络存储协议，如iSCSI、NFS、VMFS等。由于NFS简单易用，推荐使用NFS搭建网络存储。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 安装NFS服务：</span></span><br><span class="line"></span><br><span class="line">yum install nfs-utils</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 编辑 /etc/exports文件，设置主存储和二级存储的路径</span>  </span><br><span class="line">vim /etc/exports</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在文件中，增加如下内容（注意192.168.10.0/24和(rw,async,no_root_squash)之间不能有空格，）如下：</span></span><br><span class="line"></span><br><span class="line">/nfs/secondary 192.168.20.0/24(rw,async,no_root_squash)</span><br><span class="line"></span><br><span class="line">/nfs/primary 192.168.20.0/24(rw,async,no_root_squash)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 建立文件夹</span></span><br><span class="line"></span><br><span class="line">mkdir –p /nfs/secondary</span><br><span class="line"></span><br><span class="line">mkdir –p /nfs/primary</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 重新加载exports文件</span></span><br><span class="line"></span><br><span class="line">exportfs -rv</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Exportfs命令是使得本地目录可以被NFS客户端进行安装，默认使用/etc/exports文件进行导出一个或者多个目录。参数：</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-r 重新读取etc/exports文件中的设置，并使设置生效，而无需重启NFS服务</span>   </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-v 显示当前共享目录及详细的选项设置</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CentOS 6.x默认使用NFSv4。NFSv4需要所有客户端设置域。在我们的环境中域名为cs.com</span></span><br><span class="line"></span><br><span class="line">vim /etc/idmapd.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件中去掉注释并修改：</span></span><br><span class="line"></span><br><span class="line">Domain = cs.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改/etc/sysconfig/nfs，将其中的端口号全部打开</span></span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/nfs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打开下面的端口</span></span><br><span class="line"></span><br><span class="line">RQUOTAD_PORT=875</span><br><span class="line">LOCKD_TCPPORT=32803</span><br><span class="line">LOCKD_UDPPORT=32769</span><br><span class="line">MOUNTD_PORT=892</span><br><span class="line">STATD_PORT=662</span><br><span class="line">STATD_OUTGOING_PORT=2020</span><br></pre></td></tr></tbody></table></figure>



<h3 id="4-4-设置防火墙"><a href="#4-4-设置防火墙" class="headerlink" title="4.4 设置防火墙"></a>4.4 设置防火墙</h3><ul>
<li>开放防火墙端口</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开放如下端口</span></span><br><span class="line">-A INPUT -p tcp -m tcp --dport 111 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p udp -m udp --dport 111 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m tcp --dport 32803 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p udp -m udp --dport 32769 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m tcp --dport 892 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p udp -m udp --dport 892 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m tcp --dport 875 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p udp -m udp --dport 875 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m tcp --dport 662 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p udp -m udp --dport 662 -j ACCEPT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启防火墙</span></span><br><span class="line"></span><br><span class="line">service iptables restart</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>或者关闭防火墙</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭防火墙</span></span><br><span class="line">service iptables stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭开机自启</span></span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></tbody></table></figure>



<h3 id="4-5-启动NFS服务"><a href="#4-5-启动NFS服务" class="headerlink" title="4.5 启动NFS服务"></a>4.5 启动NFS服务</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">service rpcbind start</span><br><span class="line">service nfs start</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置服务为自动重启</span></span><br><span class="line">chkconfig rpcbind on</span><br><span class="line">chkconfig nfs on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看本机发布的nfs目录</span></span><br><span class="line">showmount -e</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h3 id="4-6-导入系统虚拟机模板"><a href="#4-6-导入系统虚拟机模板" class="headerlink" title="4.6 导入系统虚拟机模板"></a>4.6 导入系统虚拟机模板</h3><p>系统虚拟机在CloudStack中扮演着重要的角色，如系统虚拟机没有正确导入，CloudStack将无法管理二级存储，也就无法完成导入模板、创建新的虚拟机等操作。系统虚拟机文件很大，没有包含在CloudStack安装程序中，需要我们手工下载并导入。注意系统虚拟机的模板版本。</p>
<table>
<thead>
<tr>
<th>4.1 及之前的版</th>
<th>acton-systemvm-02062012.qcow2.bz2</th>
</tr>
</thead>
<tbody><tr>
<td>4.2 版本</td>
<td>systemvmtemplate-2013-06-12-master-kvm.qcow2.bz2</td>
</tr>
<tr>
<td>4.3 版本</td>
<td>systemvm64template-2014-01-14-master-kvm.qcow2.bz2</td>
</tr>
<tr>
<td>4.4.1 版本</td>
<td>systemvm64template-4.4.1-7-kvm.qcow2.bz2</td>
</tr>
</tbody></table>
<p>用不同的虚拟机实现方案系统虚拟机模板也是不同的：</p>
<table>
<thead>
<tr>
<th>受控机使用 KVM</th>
<th>/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt  -m /nfs/secondary -u <a target="_blank" rel="noopener" href="http://cloudstack.apt-get.eu/systemvm/4.4/systemvm64template-4.4.1-7-kvm.qcow2.bz2">http://cloudstack.apt-get.eu/systemvm/4.4/systemvm64template-4.4.1-7-kvm.qcow2.bz2</a>  -h kvm -F</th>
</tr>
</thead>
<tbody><tr>
<td>受控机使用XenServer</td>
<td>/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt  -m /nfs/secondary -u <a target="_blank" rel="noopener" href="http://download.cloud.com/templates/acton/acton-systemvm-02062012.vhd.bz2">http://download.cloud.com/templates/acton/acton-systemvm-02062012.vhd.bz2</a>  -h xenserver -F</td>
</tr>
<tr>
<td>受控机使用vCenter</td>
<td>/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt  -m /nfs/secondary -u <a target="_blank" rel="noopener" href="http://download.cloud.com/templates/burbank/burbank-systemvm-pwd.ova">http://download.cloud.com/templates/burbank/burbank-systemvm-pwd.ova</a>  -h vmware -F</td>
</tr>
</tbody></table>
<p>文件较大，需耐心等待。当然，你也可以把文件下载到本地/var目录下，下载地址：<a target="_blank" rel="noopener" href="http://cloudstack.apt-get.eu/systemvm/4.4%EF%BC%8C%E7%84%B6%E5%90%8E%E7%94%A8-f%E5%8F%82%E6%95%B0%E5%AF%BC%E5%85%A5%E3%80%82%E5%A6%82%EF%BC%9A">http://cloudstack.apt-get.eu/systemvm/4.4，然后用-f参数导入。如：</a></p>
<p>/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /nfs/secondary -f /var/systemvm64template-4.4.1-kvm.qcow2.bz2 -h kvm –F</p>
<p>也可以到[<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1c0CnH1u">http://pan.baidu.com/s/1c0CnH1u</a> 下载4.4.1 ](<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1c0CnH1u">http://pan.baidu.com/s/1c0CnH1u</a> 下载4.4.1)kvm 或者xen模版</p>
<h3 id="4-7-登陆WEB-UI"><a href="#4-7-登陆WEB-UI" class="headerlink" title="4.7 登陆WEB-UI"></a>4.7 登陆WEB-UI</h3><p>到目前为止，虽然还有很多工作要做，但你现在其实已经可以登陆CloudStack控制台了。</p>
<ol>
<li>先初始化一下管理节点（这步只要执行一次就行了）</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cloudstack-setup-management</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 启动CloudStack服务：</span></span><br><span class="line">service cloudstack-management restart</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一般情况下，它会正常启动。如果启动时报权限问题，一般是因为cloud用户没有/var/log/cloudstack/management/ 写入权限导致。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 赋日志文件权限</span></span><br><span class="line">chown cloud /var/log/cloudstack/ -R</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动CloudStack服务需要花点时间，大概等了将近3分钟才启动完成，这期间你可以查看下它的日志，确保它正常启动：</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 查看日志</span></span><br><span class="line">tail -100f /var/log/cloudstack/management/catalina.out</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 查看cloudstack 启动状态</span></span><br><span class="line">service cloudstack-management status</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5. 启动成功能后，你现在就可以用谷歌、火狐浏览器（IE访问可能有兼容性问题）访问管理节点，地址：http://管理节点ip:8080/client，默认的用户名为admin，密码是password</span></span><br></pre></td></tr></tbody></table></figure>

<img src="https://images.hnbian.cn/FmyYKTh0Zs87xNRZ9wjzxv2QwH4h?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol>
<li>Cloudstack基于tomcat提供web服务，默认使用了8080端口。如果你想改用其它端口，可以修改/etc/tomcat6/server.xml文件进行配置。</li>
<li>Cloudstack 默认安装在/etc/cloudstack/management     目录下，你可以通过修改 log4j-cloud.xml 文件来调整日志的输出级别、路径等。</li>
<li>初次登陆时会显示向导页面，一步步引导你创建第一个基础架构。目前我们的准备工作尚未完成，还无法正确添加，因此这里先选择跳过。</li>
<li>登陆后点击“基础架构”，CloudStack资源管理的功能都在“基础架构”下。其中，“区域”可以理解为一个机房，“提供点”可以理解为一个机架，“群集”是机架中主机的分组管理，“主存储”是网络存储，主要用于存放虚拟机硬盘的，当然你也可以使用本地存储，“二级存储”也是网络存储，主要用于存在虚拟机模板、快照的。</li>
<li>“系统VM”是CloudStack自带的专用虚机，用于管理二级存储及远程终端。其中二级存储虚机必须正常启动模板等功能才可用。远程终端虚机正常启动后，才能通过WEB页面直接访问虚机控制台。</li>
<li>“虚拟路由器”也是CloudStack自带的专用虚机。主要用于网络隔离、端口转发等网络相关功能。</li>
<li>根据以上的介绍，想添加新的“区域”还必须依赖于网络存储、系统虚机的支持。</li>
</ol>
<p><img src="https://images.hnbian.cn/FqKX02IURxKIHmhSkIvQJUUC2bGK?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim"></p>
<h3 id="4-8-遇到的问题"><a href="#4-8-遇到的问题" class="headerlink" title="4.8 遇到的问题"></a>4.8 遇到的问题</h3><h4 id="4-8-1-管理节点的Web界面无法访问"><a href="#4-8-1-管理节点的Web界面无法访问" class="headerlink" title="4.8.1 管理节点的Web界面无法访问"></a>4.8.1 管理节点的Web界面无法访问</h4><p>检查iptables是否阻挡了8080端口。检查cloudstack-management服务是否正常启动。</p>
<p>service cloudstack-management status</p>
<p>如果启动状态不正常，则需要检查一下日志。日志位于 /var/log/cloudstack/management/catalina.out 。根据日志中的错误提示，进行相应的处理，绝大多数问题都可以得到解决。如果日志信息不够详细，可以修改 /etc/cloudstack/management/log4j-cloud.xml来调整日志的输出级别。</p>
<h4 id="4-8-2-登陆时提示用户名密码不正确。"><a href="#4-8-2-登陆时提示用户名密码不正确。" class="headerlink" title="4.8.2 登陆时提示用户名密码不正确。"></a>4.8.2 登陆时提示用户名密码不正确。</h4><p>默认的登陆用户名为 admin 密码是 password 。如果登陆时提示不正确，可能是导入基础数据库时有的问题。重新导入基础数据库：</p>
<p>cloudstack-setup-databases cloud:123456@localhost –deploy-as=root:root密码</p>
<p>如果还不行，将数据库删掉再重新导入。</p>
<h4 id="4-8-3-CloudStack不能添加主存储或二级存储"><a href="#4-8-3-CloudStack不能添加主存储或二级存储" class="headerlink" title="4.8.3 CloudStack不能添加主存储或二级存储"></a>4.8.3 CloudStack不能添加主存储或二级存储</h4><p>检查/etc/sysconfig/nfs配置文件是否把端口都开放了。</p>
<p>检查iptables是否有阻挡。</p>
<p>检查CloudStack的“全局设置”，secstorage.allowed.internal.sites属性是否设置正确。</p>
<h4 id="4-8-4-CloudStack无法导入IOS或虚拟机模板"><a href="#4-8-4-CloudStack无法导入IOS或虚拟机模板" class="headerlink" title="4.8.4 CloudStack无法导入IOS或虚拟机模板"></a>4.8.4 CloudStack无法导入IOS或虚拟机模板</h4><p>创建好“基础架构”后，就可以导入ISO文件或虚拟机模板，为创建虚机做准备了。如果你发现注册ISO或注册模板时，状态字段一直不动，已就绪永远都是no，那一般都是因为二级存储有问题或Secondary Storage VM 有问题了。</p>
<p>选择“控制板”-&gt;系统容量，检查二级存储容量是否正确。</p>
<p>检查系统VM中的Secondary Storage VM是否正常启动。</p>
<h4 id="4-8-5-重装CloudStack"><a href="#4-8-5-重装CloudStack" class="headerlink" title="4.8.5 重装CloudStack"></a>4.8.5 重装CloudStack</h4><p>安装完CloudStack后，我们往往会做各种实验，可能会把系统搞得很乱。想删除的话非常麻烦，因为它们之间往往存在层级关系，必须先从最底层删起。有没简单的办法直接推倒重来呢？答案是有的，最简单只要重置下其数据库即可。</p>
<ol>
<li>先停掉CloudStack服务：<br>service cloudstack-management stop</li>
<li>登陆mysql控制台，删除数据库：</li>
</ol>
<p>mysql -u root -p</p>
<p>drop database cloud;</p>
<p>drop database cloud_usage;</p>
<p>drop database cloudbridge;</p>
<p>quit;</p>
<ul>
<li><p>重新导入基础数据：<br>cloudstack-setup-databases cloud:123456@localhost     –deploy-as=root:uicctech99866 (root密码) </p>
</li>
<li><p>导入相应的系统虚机模板</p>
</li>
</ul>
<p>/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /nfs/secondary -f /var/systemvm64template-4.4.1-kvm.qcow2.bz2 -h kvm –F</p>
<ul>
<li><p>删除/var/log/cloudstack/management目录下的所有日志（可选） </p>
</li>
<li><p>初始化管理节点</p>
</li>
</ul>
<p>cloudstack-setup-management</p>
<ul>
<li>授权cloud用户写日志的权限</li>
</ul>
<p>chown cloud /var/log/cloudstack/ -R</p>
<ul>
<li>关闭iptables服务（初始化管理节点后，iptables服务会自动启动）</li>
</ul>
<p>service iptables stop</p>
<ul>
<li>重启cloudstack服务</li>
</ul>
<p>service cloudstack-management restart</p>
<p>这时查看日志如果提示权限不够给cloud用户授权</p>
<p>chown cloud /var/log/cloudstack/ -R</p>
<p>这时，你再登陆就会发现一个全新的CloudStack啦。</p>
<h4 id="4-8-7-CloudStack的区域、提供点等无法用中文命名"><a href="#4-8-7-CloudStack的区域、提供点等无法用中文命名" class="headerlink" title="4.8.7 CloudStack的区域、提供点等无法用中文命名"></a>4.8.7 CloudStack的区域、提供点等无法用中文命名</h4><p> CloudStack在4.1以前的版本中，区域、提供点等均可使用中文命名，但4.1版本时却不知为何做了限制。如果在意这个功能，请使用4.1以前的版本。推荐使用 4.0.2版。</p>
<h4 id="4-8-8-CloudStack如何进行RDP远程桌面访问"><a href="#4-8-8-CloudStack如何进行RDP远程桌面访问" class="headerlink" title="4.8.8 CloudStack如何进行RDP远程桌面访问"></a>4.8.8 CloudStack如何进行RDP远程桌面访问</h4><p> CloudStack建立好Windows XP的虚拟机后，同网段的不能够进行远程桌面访问（XP里已经设置好允许远程访问，端口号3389也已经监听），telnet vmip 3389也不通。虚拟机之间也不能够互相访问。后查询资料发现，CS默认配置会导致CS外的机器连接虚拟机有问题，比如网络没有问题的机器使用远程桌面连接winxp的虚拟机会失败。是因为security groups and the ingress rules是白名单制度，如果不进行任何设置的话，网络访问虚拟机都会有问题。</p>
<p>解决办法：在infrastructure/zone/physicalNetwork/Network Service Providers/security groups/roles/ingress rules下增加一个3389的端口，就可以进行远程桌面连接了。</p>
<p>另外，可以设置ICMP方式的rule，使用0.0.0.0/0的CIDR，就完全不限制了，不过，可能会有些安全性的问题。</p>
<img src="https://images.hnbian.cn/Fntyn5Uzc3VhGzvRX0DQ-q1iu25B?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<h4 id="4-8-9-管理IP地址耗尽"><a href="#4-8-9-管理IP地址耗尽" class="headerlink" title="4.8.9 管理IP地址耗尽"></a>4.8.9 管理IP地址耗尽</h4><p>UPDATE op_dc_ip_address_alloc SET nic_id=NULL,reservation_id=NULL,taken=NULL</p>
<h4 id="4-8-10-Fail-to-generate-certificate-sudo-no-tty-present-and-no-askpass-program-specified-（With-great-power-comes-great-responsibility-sudo：没有终端存在，且未指定-askpass-程序）"><a href="#4-8-10-Fail-to-generate-certificate-sudo-no-tty-present-and-no-askpass-program-specified-（With-great-power-comes-great-responsibility-sudo：没有终端存在，且未指定-askpass-程序）" class="headerlink" title="4.8.10 Fail to generate certificate!:     sudo: no tty present and no askpass program specified （With great power     comes great responsibility.sudo：没有终端存在，且未指定 askpass 程序）"></a>4.8.10 Fail to generate certificate!:     sudo: no tty present and no askpass program specified （With great power     comes great responsibility.sudo：没有终端存在，且未指定 askpass 程序）</h4><p>修改sudo配置文件</p>
<p>命令编辑配置文件  vim /etc/sudoers</p>
<p>增加行 Defaults visiblepw</p>
<p>否则会出现 sudo: no tty present and no askpass program specified</p>
<h4 id="4-8-11-Fail-to-generate-certificate-timeout-在sudo中加入权限"><a href="#4-8-11-Fail-to-generate-certificate-timeout-在sudo中加入权限" class="headerlink" title="4.8.11 Fail to generate certificate!:     timeout  在sudo中加入权限"></a>4.8.11 Fail to generate certificate!:     timeout  在sudo中加入权限</h4><p>原因是cloud用户没有权限增加cloud 用户权限  vim /etc/sudoers  增加行  </p>
<p>cloud ALL =NOPASSWD : ALL</p>
<h4 id="4-8-12-sudo-sorry-you-must-have-a-tty-to-run-sudo-sudo：抱歉，您必须拥有一个终端来执行-sudo"><a href="#4-8-12-sudo-sorry-you-must-have-a-tty-to-run-sudo-sudo：抱歉，您必须拥有一个终端来执行-sudo" class="headerlink" title="4.8.12 sudo: sorry, you must have a tty to run sudo(sudo：抱歉，您必须拥有一个终端来执行 sudo)"></a>4.8.12 sudo: sorry, you must have a tty to run sudo(sudo：抱歉，您必须拥有一个终端来执行 sudo)</h4><p>vim /etc/sudoers</p>
<p>注释掉 Default requiretty 一行</p>
<h4 id="4-8-13-第一：安装完成后，启动cloud-management服务或者cloud-usage服务时，出现以下错误："><a href="#4-8-13-第一：安装完成后，启动cloud-management服务或者cloud-usage服务时，出现以下错误：" class="headerlink" title="4.8.13 第一：安装完成后，启动cloud-management服务或者cloud-usage服务时，出现以下错误："></a>4.8.13 第一：安装完成后，启动cloud-management服务或者cloud-usage服务时，出现以下错误：</h4><p>cloud-management dead but pid file exists</p>
<p>The pid file locates at /var/run/cloud-management.pid and lock file at /var/lock/subsys/cloud-management.</p>
<p>Starting cloud-management will take care of them or you can manually clean up.</p>
<p>将日志文件权限改为777 </p>
<p>rm /var/run/cloud-management.pid</p>
<p>或赋日志文件权限</p>
<p>chown cloud /var/log/cloudstack/ -R</p>
<h4 id="4-8-14-com-mysql-jdbc-exceptions-jdbc4-MySQLSyntaxErrorException-Euplicate-column-name-‘size’"><a href="#4-8-14-com-mysql-jdbc-exceptions-jdbc4-MySQLSyntaxErrorException-Euplicate-column-name-‘size’" class="headerlink" title="4.8.14 com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException:Euplicate column name ‘size’:"></a>4.8.14 com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException:Euplicate column name ‘size’:</h4><p>cloudstack-setup-databases cloud:123456@localhost –deploy-as=root:刚才设定的root密码</p>
<p>cloudstack-setup-management</p>
<p>执行两遍，然后重新启动即可</p>
<h2 id="5-安装-KVM"><a href="#5-安装-KVM" class="headerlink" title="5. 安装 KVM"></a>5. 安装 KVM</h2><p>KVM（kernel-based Virtual Machine）是一个开源的系统虚拟化平台，自Linux 2.6.20之后已集成到Linux内核中，因它使用Linux自身的调度器进行管理，所以相对于其他虚拟化解决方案而言，其核心源码很少也更加的稳定。CloudStack支持与多种虚拟化解决方案的集成。CloudStack+KVM是最佳的黄金组合，他们都功能强大且免费，你可以毫无顾忌地随意部署安装而不必害怕有人找你要授权费。KVM一直以来没有好的免费的集群管理工具，现在加上CloudStack后，如虎添翼，比起VCenter、XenCenter这类强力商业软件来讲也毫不逊色。</p>
<h3 id="5-1-安装kvm"><a href="#5-1-安装kvm" class="headerlink" title="5.1 安装kvm"></a>5.1 安装kvm</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install kvm kmod-kvm qemu kvm-qemu-img virt-viewer virt-manager libvirt vconfig</span><br></pre></td></tr></tbody></table></figure>



<ul>
<li>开放相关端口。</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/libvirt/libvirtd.conf</span><br><span class="line">listen_tls  =0  </span><br><span class="line">listen_tcp  = 1  </span><br><span class="line">tcp_port  = "16509"  </span><br><span class="line">mdns_adv  = 0  </span><br><span class="line">auth_tcp  = "none"  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/libvirt/qemu.conf</span><br><span class="line">vnc_listen = 0.0.0.0 </span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/libvirtd</span><br><span class="line">LIBVIRTD_ARGS="--listen"</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>启动虚拟机服务</li>
</ul>
<p>service libvirtd restart</p>
<ul>
<li>测试一下是否成功：</li>
</ul>
<p>lsmod | grep kvm</p>
<p>注： lsmod——显示已载入系统的模块</p>
<ul>
<li>检查KVM是否成功安装</li>
</ul>
<p>virsh -c qemu:///system list</p>
<p>Id Name State</p>
<h3 id="5-2-安装-Cloud-agent"><a href="#5-2-安装-Cloud-agent" class="headerlink" title="5.2 安装 Cloud-agent"></a>5.2 安装 Cloud-agent</h3><p>KVM不像XenServer、VCenter等已经内置了强大的管理功能，因此必须安装一个CloudStack代理来完成主控端发来的指令。直接通过仓库安装：</p>
<p>yum install cloud-agent</p>
<p>注意：安装完 cloud-agent 后无需启动，等管理节点中添加主机时会自动启动。    默认的安装目录：/etc/cloudstack/agent</p>
<p>CloudStack是通过log4j来输出日志的，可以通过修改log4j-cloud.xml文件来调整日志的输出结构。</p>
<h3 id="5-3-添加主机"><a href="#5-3-添加主机" class="headerlink" title="5.3 添加主机"></a>5.3 添加主机</h3><p>到目前为止，你的准备工作已经完成了。如果创建的是简单网络域的话，你现在就可以在管理节点的WEBUI中顺利添加这台受控主机啦。这步的操作方法非常简单，CloudStack中有一个非常友好的向导，应该可以帮助你正确完成添加。</p>
<h3 id="5-4-常见问题"><a href="#5-4-常见问题" class="headerlink" title="5.4 常见问题"></a>5.4 常见问题</h3><h4 id="5-4-1-在管理节点中添加主机失败"><a href="#5-4-1-在管理节点中添加主机失败" class="headerlink" title="5.4.1 在管理节点中添加主机失败"></a>5.4.1 在管理节点中添加主机失败</h4><p>添加主机时失败，请查看日志。</p>
<p>管理节点日志在/var/log/cloudstack/management/catalina.out</p>
<p>受控节点日志在/var/log/cloudstack/agent/cloudstack-agent.out</p>
<h4 id="5-4-2-Unable-to-start-agent-Failed-to-get-private-nic-name"><a href="#5-4-2-Unable-to-start-agent-Failed-to-get-private-nic-name" class="headerlink" title="5.4.2 Unable to start agent: Failed to get private nic name"></a>5.4.2 Unable to start agent: Failed to get private nic name</h4><p>在CloudStack中，流量标签是同受控主机的网桥相关的，如果设置了流量标签，则受控机必须设置相应的网桥。CloudStack4.3的agent在启动时，默认会自动创建cloudbr0和cloudbr1两个网桥。如果你指定了其他的标签名，则相应的网桥也要作修改，甚至需要在受控机上手工创建网桥。</p>
<p>如果想修改成其他网桥名字，那么需要在配置文件里面指定：</p>
<p>vim /etc/cloudstack/agent/agent.properties</p>
<p>修改下面两个参数</p>
<p>private.network.device</p>
<p>public.network.devic</p>
<p>如果网桥指定错误的话，那么就会出现上面的错误。</p>
<h4 id="5-4-3-Failed-to-create-vnet"><a href="#5-4-3-Failed-to-create-vnet" class="headerlink" title="5.4.3 Failed to create vnet"></a>5.4.3 Failed to create vnet</h4><p>如果你再尝试创建高级网络，出现的如上的错误，那是因为你没有安装vconfig程序。</p>
<p>yum install vconfig</p>
<h4 id="5-4-4-libvirtd-dead-but-subsys-is-locked（libvirtd-已死，但是-subsys-被锁）"><a href="#5-4-4-libvirtd-dead-but-subsys-is-locked（libvirtd-已死，但是-subsys-被锁）" class="headerlink" title="5.4.4 libvirtd dead but subsys is locked（libvirtd 已死，但是 subsys 被锁）"></a>5.4.4 libvirtd dead but subsys is locked（libvirtd 已死，但是 subsys 被锁）</h4><p>yum install libdaemon avahi</p>
<p>service messagebus start</p>
<p>service avahi-daemon start</p>
<p>service libvirtd start</p>
<p>发现还是“libvirtd dead but subsys is locked”，在/var/lock/subsys/下面还是有libvirtd这个锁，于是想到selinux还没有禁用，于是</p>
<p>vi /etc/sysconfig/selinux</p>
<p>SELINUX=disabled</p>
<p>重新启动虚拟机，</p>
<p>service messagebus start</p>
<p>service avahi-daemon start</p>
<p>service libvirtd start</p>
<p>service libvirtd status</p>
<p>libvirtd is running，ok了</p>
<p>[root@server1 ~]# virsh -c qemu:///system list #使用这个命令检查KVM是否成功安装</p>
<p>Id Name State</p>
<p>（ps:hnbian:我在解决的时候上面的解决办法不好用，然后把kvm安装 1.2 小节中的vnc_listen = 0.0.0.0 改成vnc_listen = “0.0.0.0” 好了）</p>
<h2 id="6-NOVNC安装"><a href="#6-NOVNC安装" class="headerlink" title="6. NOVNC安装"></a>6. NOVNC安装</h2><ol>
<li>下载NOVNC</li>
</ol>
<p>cd /var/</p>
<p>git clone git://github.com/kanaka/noVNC</p>
<ol start="2">
<li>如何使用NOVNC</li>
</ol>
<p>cd noVNC/ utils</p>
<p>使用联创中控修改的launch.sh替换novnc自带的launch.sh</p>
<p>./ launch.sh</p>
<ol start="3">
<li>通过Web页面访问虚拟机</li>
</ol>
<p>1）编程时动态往/var/noVNC/vnc_tokens文件中写入虚拟机IP和端口号与Token值的对应关系，如下面所示，注意Token值与虚拟机IP和端口号见有个空格。</p>
<p>02f63e037a3c485c8fd5c0164c6ef67b: 192.168.20.3:5902</p>
<p>2）在浏览器中访问：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.20.2:6080/vnc_auto.html?path=?token=02f63e037a3c485c8fd5c0164c6ef67b&amp;password=63c4b2ecfee93b8b">http://192.168.20.2:6080/vnc_auto.html?path=%3ftoken=02f63e037a3c485c8fd5c0164c6ef67b&amp;password=63c4b2ecfee93b8b</a></p>
<p>可以自动连接到对应虚拟机的控制台，其中token是/var/noVNC/vnc_tokens文件中存在的token值，password是访问虚拟机的vnc密码。</p>
<p>这里要特别注意一下，在url中%3f是’?’的url编码，我们不能直接使用path=?token=abc123这种格式。</p>
<h2 id="7-VNCDoTool安装"><a href="#7-VNCDoTool安装" class="headerlink" title="7. VNCDoTool安装"></a>7. VNCDoTool安装</h2><ol>
<li>安装python-devel</li>
</ol>
<p>yum install python-devel</p>
<ol start="2">
<li>安装VNCDoTool</li>
</ol>
<p>pip install vncdotool</p>
<p>注：</p>
<ul>
<li>若找不到pip命令，执行下面的语句</li>
</ul>
<p>wget –no-check-certificate <a target="_blank" rel="noopener" href="http://pypi.python.org/packages/source/s/setuptools/setuptools-0.6c11.tar.gz">http://pypi.python.org/packages/source/s/setuptools/setuptools-0.6c11.tar.gz</a></p>
<p>tar zxvf setuptools-0.6c11.tar.gz</p>
<p>cd setuptools-0.6c11</p>
<p>python setup.py build</p>
<p>python setup.py install</p>
<p>wget –no-check-certificate <a target="_blank" rel="noopener" href="https://github.com/pypa/pip/archive/1.5.5.tar.gz">https://github.com/pypa/pip/archive/1.5.5.tar.gz</a></p>
<p>tar zvxf 1.5.5</p>
<p>cd pip-1.5.5/</p>
<p>python setup.py install</p>
<ul>
<li>如果安装过程中出现依赖包缺失，则运行下面的命令：</li>
</ul>
<p>pip install virtualenv</p>
<p>virtualenv venv-vncdotool</p>
<p># XXX requirements.txt from vncdotool source tree</p>
<p>pip install -r requirements.txt</p>
<p>pip install -e .</p>
<ol start="3">
<li>如何截屏</li>
</ol>
<p>vncdo -s 192.168.20.3:5902 capture screen.png</p>
<h2 id="8-CloudStack密码加密和解密"><a href="#8-CloudStack密码加密和解密" class="headerlink" title="8. CloudStack密码加密和解密"></a>8. CloudStack密码加密和解密</h2><h3 id="8-1-加密与解密"><a href="#8-1-加密与解密" class="headerlink" title="8.1 加密与解密"></a>8.1 加密与解密</h3><p>CloudStack存储一些敏感密码和密钥用于提供安全保障。这些值被自动加密。</p>
<ul>
<li>数据库密钥（该密钥不是数据库用户密码，而是在使用cloudstack-setup-databases初始化数据库时，如果加了-m 选项，对db.properties文件中关键参数进行加密。默认为“password”，可在/etc/cloudstack/management/key文件中查看）</li>
<li>数据库密码</li>
<li>SSH密钥</li>
<li>计算节点root密码</li>
<li>VPN密码</li>
<li>用户API密钥</li>
<li>VNC密码</li>
</ul>
<p>CloudStack使用简单的java加密库（JASYPT）。使用数据库密钥加密和解密数据值，随着数据库密码一起存储在CloudStack内部属性文件中。 上面列出的其他加密值, 例如 SSH 密钥, 也被记录在CloudStack数据库中。</p>
<p>当然，数据库密钥本身不可以公开存储-必须被加密存储。那么，CloudStack如何阅读它呢？从外部源启动管理服务器期间必须提供另一个密钥。有2种方法提供该密钥：从文件加载或者由CloudStack的管理员提供。CloudStack数据库中有个配置项,将会告知使用了哪种方法。如果加密类型设置为 “file,” 密钥必须存在于位置已知的文件中。如果加密类型设置为 “web,” 管理员则会运行</p>
<p>com.cloud.utils.crypt.EncryptionSecretKeySender</p>
<p>工具，关键在于连接至管理服务器中一个已知的端口。</p>
<p>在CloudStack初始化的过程中设置加密类型，数据库密钥和管理服务器密钥。这些都是CloudStack数据库设置脚本的参数（cloud-setup-databases)。默认值是file,password和password。当然，强烈建议你修改这些密钥值。</p>
<p>好了，更多信息查看CloudStack官方文档。</p>
<p>直接上干货。</p>
<h3 id="8-2-解密虚拟机VNC密码"><a href="#8-2-解密虚拟机VNC密码" class="headerlink" title="8.2 解密虚拟机VNC密码"></a>8.2 解密虚拟机VNC密码</h3><p>新版本CS中默认启用虚拟机的VNC密码，保证安全性。但，CPVM的性能，呵呵。</p>
<p>所以当不想通过CPVM时，需要解密VNC密码才能连接直接通过vnc工具连接。</p>
<p>以KVM为例：</p>
<p>（其实有两个简单的方式可以让你快速得到VNC密码：1、在kvm主机中通过 “virsh edit 虚拟机名称”，进去编辑状态，可以查看到明文的VNC密码。2、通过virt-manager打开某个虚拟机，先在details里面种手动将VNC密码修改，然后再使用更改后的密码登录；第二个方法慎用，可能会造成CS页面中Console功能异常，不过虚拟机关机，再开机后密码会重新生成，console恢复正常。）。</p>
<p>\1. 在CloudStack UI中查找该虚拟机的内部名称。例如：i-2-15-VM</p>
<p>\2. 在CloudStack数据库中查找该虚拟机加密后的vnc密码</p>
<p>mysql&gt; select vnc_password from cloud.vm_instance where instance_name = ‘i-2-15-VM’ or name = ‘InstanceName’;</p>
<p>+———————————————-+</p>
<p>| vnc_password                 |</p>
<p>+———————————————-+</p>
<p>| mmwJnTulUgSWyd/NdiXAkRtI+y+33h5dbuk4+OGpkck= |</p>
<p>+———————————————-+</p>
<p>1 row in set (0.00 sec)</p>
<h3 id="8-3-使用jasypt库解密"><a href="#8-3-使用jasypt库解密" class="headerlink" title="8.3 使用jasypt库解密"></a>8.3 使用jasypt库解密</h3><p>jasypt库路径为：</p>
<p>[root@localhost ~]# /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar</p>
<p>使用如下命令解密：</p>
<p>[root@localhost ~]# java -cp /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar </p>
<p>org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI input=”上步骤中得到的vnc密码” </p>
<p>password=”数据库密钥（参见前面解释）”</p>
<p>例如：</p>
<p>[root@localhost ~]# java -cp </p>
<p>/usr/share/cloudstack-common/lib/jasypt-1.9.0.jar </p>
<p>org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI </p>
<p>input=”mmwJnTulUgSWyd/NdiXAkRtI+y+33h5dbuk4+OGpkck=” password=”password”</p>
<p>—-ENVIRONMENT—————–</p>
<p>Runtime: Sun Microsystems Inc. OpenJDK 64-Bit Server VM 20.0-b12 </p>
<p>—-ARGUMENTS——————-</p>
<p>input: mmwJnTulUgSWyd/NdiXAkRtI+y+33h5dbuk4+OGpkck=</p>
<p>password: password</p>
<p>—-OUTPUT———————-</p>
<p>f7d7ae4bac54cfa2</p>
<p>其中，OUTPUT即为解密后的vnc密码，使用该密码连接VNC控制台。</p>
<h3 id="8-4-解密计算节点root密码"><a href="#8-4-解密计算节点root密码" class="headerlink" title="8.4 解密计算节点root密码"></a>8.4 解密计算节点root密码</h3><p>还是以kvm为例，该密码为添加主机时使用的root密码。</p>
<p>1.在数据库host_details表中查出加密后的主机密码字段</p>
<p>+—-+———+———-+———————————-+</p>
<p>| id | host_id | name   | value              |</p>
<p>+—-+———+———-+———————————-+</p>
<p>| 10 |    1 | password | jQ5GklnC7FEShUJUo0uZs4p9LYclP8ng |</p>
<p>| 20 |    4 | password | f8qWuceOf6AzeN+AJ82OYQN7mSqiqYPU |</p>
<p>| 30 |    5 | password | 6icHGY6p5O+fq+hrJ/CRv9u+SaVPvvmj |</p>
<p>| 40 |    6 | password | OcU/tzEcZXzKhjaxQA8n48usagBXCpPm |</p>
<p>+—-+———+———-+———————————-+</p>
<p>4 rows in set (0.00 sec)</p>
<p>2.复制value值，进行解密</p>
<p>[root@localhost ~]# java -cp /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar </p>
<p>org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI </p>
<p>input=”jQ5GklnC7FEShUJUo0uZs4p9LYclP8ng” password=”password”</p>
<p>[root@localhost ~]# java -cp</p>
<p> /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar </p>
<p>org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI </p>
<p>input=”f8qWuceOf6AzeN+AJ82OYQN7mSqiqYPU” password=”password”</p>
<p>[root@localhost ~]# java -cp</p>
<p> /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar </p>
<p>org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI </p>
<p>input=”6icHGY6p5O+fq+hrJ/CRv9u+SaVPvvmj” password=”password”</p>
<p>[root@localhost ~]# java -cp</p>
<p> /usr/share/cloudstack-common/lib/jasypt-1.9.0.jar </p>
<p>org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI </p>
<p>input=”OcU/tzEcZXzKhjaxQA8n48usagBXCpPm” password=”password”</p>
<p>其中，OUTPUT即为解密后的密码。</p>
<h2 id="9-kvm嵌套虚拟化"><a href="#9-kvm嵌套虚拟化" class="headerlink" title="9. kvm嵌套虚拟化"></a>9. kvm嵌套虚拟化</h2><h3 id="9-1-确认软硬件环境支持"><a href="#9-1-确认软硬件环境支持" class="headerlink" title="9.1 确认软硬件环境支持"></a>9.1 确认软硬件环境支持</h3><h4 id="9-1-1-物理机的CPU支持硬件虚拟化技术"><a href="#9-1-1-物理机的CPU支持硬件虚拟化技术" class="headerlink" title="9.1.1 物理机的CPU支持硬件虚拟化技术"></a>9.1.1 物理机的CPU支持硬件虚拟化技术</h4><p>grep -E ‘^flags.*(vmx|svm)’ /proc/cpuinfo</p>
<p>flags: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm pcid sse4_1 sse4_2 popcnt tsc_deadline_timer xsave avx lahf_lm arat epb xsaveopt pln pts dtherm tpr_shadow vnmi flexpriority ept vpid</p>
<p>得到类似的输出，如果没有则表示当前CPU不支持硬件虚拟化技术。</p>
<h3 id="9-2-升级RHEL6-5的kernel"><a href="#9-2-升级RHEL6-5的kernel" class="headerlink" title="9.2 升级RHEL6.5的kernel"></a>9.2 升级RHEL6.5的kernel</h3><p>嵌套式虚拟是一个可通过内核参数来启用的功能。很可惜，现有的 RHEL6.x 内核暂时并未支持此参数。</p>
<p>你可以通过 cat /sys/module/kvm_intel/parameters/nested 或者 modinfo kvm-intel |grep nested 来确定你的系统是否支持nested这个参数。默认的RHEL6的系统上此参数并不存在。</p>
<p>那么就需要升级内核来支持nested。你可以选择到<a target="_blank" rel="noopener" href="https://www.kernel.org/">Linux内核官网</a>下载较新的内核（不建议最新，一些太新的内核特性跟保守的RHEL系可能不能很好的兼容），手动编译安装。</p>
<p>这里一个简单的方法，利用CentOS社区xen-c6项目中提供的一个支持nested参数的内核。</p>
<h4 id="9-2-1-添加xen-c6的软件库"><a href="#9-2-1-添加xen-c6的软件库" class="headerlink" title="9.2.1 添加xen-c6的软件库"></a>9.2.1 添加xen-c6的软件库</h4><p>cd /etc/yum.repos.d</p>
<p>wget <a target="_blank" rel="noopener" href="http://dev.centos.org/centos/6/xen-c6/xen-c6.repo">http://dev.centos.org/centos/6/xen-c6/xen-c6.repo</a></p>
<p>vim /etc/yum.repos.d/xen-c6.repo</p>
<p>[xen-c6]</p>
<p>name=CentOS-$releasever - Xen</p>
<p>baseurl=<a target="_blank" rel="noopener" href="http://dev.centos.org/centos/6/xen-c6/$basearch/">http://dev.centos.org/centos/6/xen-c6/$basearch/</a></p>
<p>gpgcheck=0</p>
<p>Priority=1</p>
<p>enabled=0</p>
<p>[xen-c6-source]</p>
<p>name=CentOS-$releasever - Xen Source</p>
<p>baseurl=<a target="_blank" rel="noopener" href="http://dev.centos.org/centos/6/xen-c6/SRPMS/">http://dev.centos.org/centos/6/xen-c6/SRPMS/</a></p>
<p>gpgcheck=0</p>
<p>Priority=1</p>
<p>enabled=0</p>
<p>将其修改为enabled=0令这个第三方的软件库不会被默认启用。</p>
<h4 id="9-2-2-安装新的内核"><a href="#9-2-2-安装新的内核" class="headerlink" title="9.2.2 安装新的内核"></a>9.2.2 安装新的内核</h4><p>yum –enablerepo xen-c6 install kernel kernel-firmware</p>
<p>安装完成后，修改grub.conf，确定系统从新的内核启动，并重启系统。</p>
<h3 id="9-3-开启kvm内核模块的nested参数"><a href="#9-3-开启kvm内核模块的nested参数" class="headerlink" title="9.3 开启kvm内核模块的nested参数"></a>9.3 开启kvm内核模块的nested参数</h3><h4 id="9-3-1-重新加载kvm内核并指定netsted-1参数"><a href="#9-3-1-重新加载kvm内核并指定netsted-1参数" class="headerlink" title="9.3.1 重新加载kvm内核并指定netsted=1参数"></a>9.3.1 重新加载kvm内核并指定netsted=1参数</h4><p>rmmod kvm_intel</p>
<p>modprobe kvm-intel nested=1</p>
<p>cat /sys/module/kvm_intel/parameters/nested</p>
<p>Y</p>
<h4 id="9-3-2-确定下次重启自动开启"><a href="#9-3-2-确定下次重启自动开启" class="headerlink" title="9.3.2 确定下次重启自动开启"></a>9.3.2 确定下次重启自动开启</h4><p>方法1：</p>
<p>vim /etc/grub.conf</p>
<p>在kernel行后面加上</p>
<p>kvm-instel.nested=1</p>
<p>（注意：！！这里是在kernel行后面加，不是在文件最后行加）</p>
<p>方法2：</p>
<p>echo “options kvm-intel nested=1” ?&gt; /etc/modprobe.d/kvm-intel.conf</p>
<h3 id="9-2-编辑agent配置文件"><a href="#9-2-编辑agent配置文件" class="headerlink" title="9.2 编辑agent配置文件"></a>9.2 编辑agent配置文件</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/cloudstack/agent/agent.properties</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加下面内容</span></span><br><span class="line"></span><br><span class="line">guest.cpu.mode=custom</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">guest.cpu.mode=host-model</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">guest.cpu.mode=host-passthrough（这里推荐用这个）</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若选择 guest.cpu.mode=custom就需要增加下面这行，选其他的不必添加下面这行</span></span><br><span class="line"></span><br><span class="line">guest.cpu.model=xxxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xxxx内容是从 /usr/share/libvirt/cpu_map.xml 文件中选取的，是选择CPU的类型</span></span><br></pre></td></tr></tbody></table></figure>



<p>解释说明：</p>
<p>custom: 选择custrom时你可以直接显视的给出CPU的module name规范，这个规范从文件 /usr/share/libvirt/cpu_map.xml中查找。</p>
<p>host-model: libvirt 根据/usr/share/libvirt/cpu_map.xml 文件来自动确定 CPU 模型。选择和主机最相近的匹配。 尽可能找到CPU性能和flags参数相近的主机。</p>
<p>host-passthrough: libvirt 会告诉KVM向没有修改过CPU的主机迁移. 与host-model的差别是不仅匹配flags特性，还要匹配CPU的每一个特性. 这将给出绝对最好的性能， 同时对一些应用程序很重要，但这样做会付出一些代价：虚拟机之间的迁移只会迁移到完全匹配CPU的主机上。</p>
<p>提示：使用host-passthrough参数可能会导致迁移失败，这个时候建议你改成host-model 或custom参数。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">custom</span><br><span class="line"></span><br><span class="line">  guest.cpu.mode=custom</span><br><span class="line"></span><br><span class="line">  guest.cpu.model=SandyBridge</span><br><span class="line"></span><br><span class="line">host-model</span><br><span class="line"></span><br><span class="line">  guest.cpu.mode=host-model</span><br><span class="line"></span><br><span class="line">host-passthrough</span><br><span class="line"></span><br><span class="line">  guest.cpu.mode=host-passthrough（这里推荐用这个）</span><br></pre></td></tr></tbody></table></figure>

<p>注意：cloudstack-agent服务不必手动开启，ManagementServer在添加主机的时候会自动帮你启动。</p>
<h2 id="10-CloudStack-配置"><a href="#10-CloudStack-配置" class="headerlink" title="10. CloudStack 配置"></a>10. CloudStack 配置</h2><p>登陆http://管理节点IP:8080/client，用户名：admin，密码：password</p>
<h3 id="10-1-添加基础架构"><a href="#10-1-添加基础架构" class="headerlink" title="10.1 添加基础架构"></a>10.1 添加基础架构</h3><p>现在CloudStack管理节点所有的准备工作都已经完成了。接下来你就可以添加自己的第一个“区域”了。建议安装完一个计算节点再进行添加基础架构的操作。</p>
<img src="https://images.hnbian.cn/FjTpP6YjB0MhuW40rHbWbzzb-gKE?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FqoT2HbymXV-wfic33edRjOK3qR2?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FntywmblHvRWX58_rE1YvmqDQATE?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/Fn8MGTtGnQH6fojaDSaMjTRB-VLq?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FulzE8o1vb6Jr3voHpERSFnX981S?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/Fr53JNnk6-y1FZswFotGAQI27GMX?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/Fho_SodFiKsjhHEf-khp_uqcW96q?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ul>
<li>注意和上边的提供点的IP范围不能重复</li>
</ul>
<img src="https://images.hnbian.cn/FssQqDPms6PlRHvEL0FvTmbBDQry?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FgEx_3LNty9hFIKubYt8-QmKIwIu?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/Flusum-omS9HvdRBhAFYO-4H4ZHv?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FvvETT7BBbMzvp1LKQLniTNiHgBa?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FlKZUH_0OH5s-0xO0HmeDoPXUKYA?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FiXLoqoUUn3tSKTC2S3zsASd5Snn?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FqajIUYuA_Gpl-HJHfvo6Ww3NDyH?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FuNQxaXMfURhMuI_XZKYh-1Z2kct?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FjT6GvTDBHB_k9vafNx08EQ2gyxp?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/Fk51uCYLvaC6n0Gg0jgwaATtaVOD?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<h3 id="10-2-高级网络配置"><a href="#10-2-高级网络配置" class="headerlink" title="10.2 高级网络配置"></a>10.2 高级网络配置</h3><ol>
<li>登录cloudstack</li>
</ol>
<p>默认帐号是admin 密码是 password 如果密码不对 查看管理节点安装Q&amp;A的解决办</p>
<img src="https://images.hnbian.cn/FkNUwftVD9mz4TANabT3cyhyTs9H?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="2">
<li>向导页</li>
</ol>
<p>这里我们要进行高级网络配置，点击跳过指南。</p>
<img src="https://images.hnbian.cn/FuurP_azLNP3CVALsOIr9h82SMf-?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="3">
<li>进入cloudstack环境的首页</li>
</ol>
<img src="https://images.hnbian.cn/FmirTK5z-n2pOn3EdnXUlKxbtlAI?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="4">
<li>点击基础架构</li>
</ol>
<p>这时我们没有做任何配置，所以各个节点的设备数量均为0</p>
<img src="https://images.hnbian.cn/FvGI3US2pH1Zh_M7FYaXNkB9Gxgq?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="5">
<li>点击区域</li>
</ol>
<img src="https://images.hnbian.cn/FnKOkfn65r3seoKj5ui_3Abs5vzm?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="6">
<li>点击添加区域</li>
</ol>
<p>基本为基本网络，高级为高级网络，这里我们要进行高级网络配置，故我们选择高级网络。点击next。</p>
<img src="https://images.hnbian.cn/FsDdtpgLTUZvH6peVpvXagsMExmR?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="7">
<li>添加区域</li>
</ol>
<img src="https://images.hnbian.cn/FpW2_D1JH57SZtOyjVcka5935ipf?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="8">
<li>设置物理网络</li>
</ol>
<img src="https://images.hnbian.cn/FoScbxwlrK0_skr1iB9PvZH8up76?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="9">
<li>添加公共通信ip范围</li>
</ol>
<img src="https://images.hnbian.cn/FjLi9aq8y3bpJTt1cY4RKvfLrtpm?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="10">
<li>添加提供点</li>
</ol>
<img src="https://images.hnbian.cn/FmCH24kK-TyhQBK-xD1pxLO31bFM?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="11">
<li>添加来宾通信范围</li>
</ol>
<img src="https://images.hnbian.cn/FiTW3oFynuT6JGOLtKIKegp0QW_I?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="12">
<li>设置集群名称</li>
</ol>
<p>虚拟机管理程序在之前选择过了，所以这里的虚拟机管理程序有默认值，添加集群名称点击next。</p>
<img src="https://images.hnbian.cn/Fr5p4NZEYPdOCFFlvIW070UzCh0p?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="13">
<li>向集群添加主机</li>
</ol>
<img src="https://images.hnbian.cn/FnfIZN1ZFAtrpWiRXT7HtRJjEulI?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="14">
<li>添加主存储</li>
</ol>
<img src="https://images.hnbian.cn/FlfczQoQZXPvMakUdT1K_Z1IkqGQ?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="15">
<li>添加辅助存储</li>
</ol>
<img src="https://images.hnbian.cn/FiTWh8NXQDcOhTZqPst6FPjwaoeM?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="16">
<li>所有准备工作已经完成 进行下一步骤</li>
</ol>
<img src="https://images.hnbian.cn/Fr8A0ykiufMMdc1rcWuS2WEv50zA?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<h3 id="10-3-修改全局属性"><a href="#10-3-修改全局属性" class="headerlink" title="10.3 修改全局属性"></a>10.3 修改全局属性</h3><p>CloudStack有一个全局属性来控制二级存储所在的网段。如果这个网段没配或配置的不对，将可能无法成功能添加到二级存储。登陆 CloudStack 管理页面，选择“全局设置”，在右上边的搜索框中输入</p>
<ol>
<li>进行修改</li>
</ol>
<table>
<thead>
<tr>
<th>修改项</th>
<th>操作方式</th>
</tr>
</thead>
<tbody><tr>
<td>搜索sites</td>
<td>修改  secstorage.allowed.internal.sites 为二级存储当前网段，如  192.168.10.0/24，表示Web服务器的网段在192.168.1.0，或者192.168.1.180/32，表示Web服务器的IP地址为192.168.1.180。</td>
</tr>
<tr>
<td>搜索local</td>
<td>修改system.vm.use.local.storage  为 true。  允许系统虚机使用本地存储。修改后，重启CloudStack生效。</td>
</tr>
<tr>
<td>搜索control</td>
<td>修改control.cidr为192.168.10.0/24    修改control.gateway为192.168.1.1</td>
</tr>
<tr>
<td>搜索management</td>
<td>修改management.network.cidr为192.168.1.0/24</td>
</tr>
</tbody></table>
<ol start="2">
<li>修改之后重启CloudStack</li>
</ol>
<p>service cloudstack-management restart</p>
<h3 id="10-4-基础网络多网段配置"><a href="#10-4-基础网络多网段配置" class="headerlink" title="10.4 基础网络多网段配置"></a>10.4 基础网络多网段配置</h3><ol>
<li>添加一个提供点</li>
</ol>
<img src="https://images.hnbian.cn/FnDl-u6YsPxnoCi7GyWTu-z9-Kmv?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="2">
<li>在刚刚添加的提供点下面添加集群</li>
</ol>
<img src="https://images.hnbian.cn/FvOuZe9fkZGwldEUx9cQvPBXdueH?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="3">
<li>在刚刚添加的集群下面添加主机（注意该主机的ip需要在此提供点的要在该提供点的网段内）</li>
</ol>
<img src="https://images.hnbian.cn/Fn_ua-B7uL_NFOSlRxFLKb-DRPAe?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="4">
<li>为添加的提供点 添加ip范围</li>
</ol>
<img src="https://images.hnbian.cn/FgaPVQppJx8KFqmIO7FCsQ2Zpy5f?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<p>新增实例测试多网段，如果能创建出该网段的实例，并且该实例能够正常通信，说明基础网络多网段配置成功</p>
<h3 id="10-5-高可用性（HA）的配置"><a href="#10-5-高可用性（HA）的配置" class="headerlink" title="10.5 高可用性（HA）的配置"></a>10.5 高可用性（HA）的配置</h3><ol>
<li>添加支持ha的计算方案</li>
</ol>
<img src="https://images.hnbian.cn/FnCui4tiX3Efw6y1rHO3SFU7MgnA?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="2">
<li>全局设置 搜索 ha.tag</li>
</ol>
<p>添加值为ha（其他值也可以只要与主机标签值一致即可）</p>
<img src="https://images.hnbian.cn/Fjje_08KdMF0-h5-omde175pvDkm?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<ol start="3">
<li>修改主机标签</li>
</ol>
<img src="https://images.hnbian.cn/FhMNlX-Kx-qESgmoUltqpp1p0psv?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<p>注意：</p>
<ul>
<li>这里主机标签的值要与刚刚设置ha.tag 的值一致。</li>
<li>当看到已启用高可用性为 yes 说明配置成功。</li>
<li>如果你只有两台计算节点时，不能将两台都设置为高可用性。</li>
<li>计算节点的高可用星要在一个集群内才能生效</li>
</ul>
<h2 id="11-虚拟机安装"><a href="#11-虚拟机安装" class="headerlink" title="11. 虚拟机安装"></a>11. 虚拟机安装</h2><h3 id="11-1-SystemVM模板"><a href="#11-1-SystemVM模板" class="headerlink" title="11.1 SystemVM模板"></a>11.1 SystemVM模板</h3><p>导入系统虚拟机模板后，可在WEB-UI界面进行查看。注意SystemVM的已就绪状态必须为“Yes”，若不是，请查看日志检查错误。</p>
<img src="https://images.hnbian.cn/Fv-lWEQzKe0OHPRQYwBTHXYvulHi?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fow6kdjJ_NMzHgTb5ZLurTuwOJJC?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<p>在“模板”界面上，你还会发现有“CentOS 5.5(64-bit) no GUI (KVM)”模板，这是CloudStack的测试模板，且已就绪状态为“No”，不必担心，SystemVm起来后会默认自动后台下载的。可以查看/nfs/secondary/template/tmpl/1/4目录下的文件，不断刷新你就会发现有个文件越来越大。</p>
<img src="https://images.hnbian.cn/FpovAr9iC2pGRNWWIHyMJ7aQqnDX?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<h3 id="11-2-注册ISO"><a href="#11-2-注册ISO" class="headerlink" title="11.2 注册ISO"></a>11.2 注册ISO</h3><img src="https://images.hnbian.cn/FlCWHa6QwYan2SztDQkyMOgL_-uO?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<p>将镜像文件放在tomcat文件夹下的webapps\ROOT文件夹下</p>
<p>如下图URL 如果tomcat 在本机的话不能使用127.0.0.1或者loaclhost</p>
<img src="https://images.hnbian.cn/Fijq_L5pnAm7015X6ba6UHGvl5rj?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<p>开始下载ISO文件，需要等待较长的时间</p>
<img src="https://images.hnbian.cn/FloQcyHBSAXyRBzv0uXPVGGoeZaP?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<p>下载完成后，已就绪变为“Yes”，状态为“Successfully Installed”，若状态为“Successfully Installed”，但已就绪为“No”，重启cloudstack-management服务。</p>
<img src="https://images.hnbian.cn/FpAS3GiI91ax0GP6NsM1GfvwA-Oj?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<h3 id="11-3-通过ISO安装实例"><a href="#11-3-通过ISO安装实例" class="headerlink" title="11.3 通过ISO安装实例"></a>11.3 通过ISO安装实例</h3><img src="https://images.hnbian.cn/FoPGSVTEDx2Zs8IIb6eGrQjvyDz7?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FqK0-D3l6KR2kvtfB1TEbb2XGpQZ?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FvgGhKVQyzlSGw9nFz92EAWS6HiK?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/FjeW3oNUpHdxnmdU85BHN1kAQ5yd?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fpc2HxpeHYVG5Wkk8JA5Pmf9uRdT?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/FtiG26yaxP_qFRJNfj-hH_PgH8ao?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FvVeBtEYiBVJM25spLz8vBxoZTeT?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fq1Kf7dloEQA3RrqnFLPeKAIrAMM?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<h3 id="11-4-创建模板"><a href="#11-4-创建模板" class="headerlink" title="11.4 创建模板"></a>11.4 创建模板</h3><p>CloudStack支持将已安装的虚拟机的系统磁盘创建成模板。创建模板前需先将虚拟机关闭</p>
<img src="https://images.hnbian.cn/FmyfmfWLKdTe1nb8SJXOYJTydSoC?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/Fktod5i2vDvD7wYM06knn6bAHoOd?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<h3 id="11-5-通过模板安装实例"><a href="#11-5-通过模板安装实例" class="headerlink" title="11.5 通过模板安装实例"></a>11.5 通过模板安装实例</h3><img src="https://images.hnbian.cn/FmfPXhcWB8P538tcb_LPDK-uXnBh?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fvn-Nl9Yujx_lZVOmnyYGJ0mOnPG?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fpp7sSW5TuALfe2wU0xPX4Fm_mG6?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<img src="https://images.hnbian.cn/FnPQ_JOf-2KmFcZXvJVKjCBqTSuE?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fu6BlZhGfLmc6OfI55N9Gs7tYzqU?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fp375vBCIV0GstXjPWg7qwpRLpWX?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/FlWadgduMzmVIHkNCZqnS-EyUFlH?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">



<img src="https://images.hnbian.cn/Fgjjz612eBkg0S-p2m5IT5Gf65QU?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">





<h2 id="12-使用CludStack-API"><a href="#12-使用CludStack-API" class="headerlink" title="12. 使用CludStack API"></a>12. 使用CludStack API</h2><h3 id="12-1-使用方法"><a href="#12-1-使用方法" class="headerlink" title="12.1 使用方法"></a>12.1 使用方法</h3><p>CloudStack API基于Web Service，可以使用任何一种支持HTTP调用的语言（例如 Java，PHP）编写代码。</p>
<p>在全局配置中设置API服务器端口（integration.api.port，默认为空），比如设置成8096。需要特别注意，在全局配置打开Api服务端口之后，用户要自己对安全负责，因为这里没有任何的认证及鉴权的步骤。</p>
<p>访问方式：BaseUrl+CommandString，其中BaseUrl为<a href="http://ip:port/client/api?，CommandString为API命令加参数组成的字符串，详见API文档。例如：http://192.168.1.150:8096/client/api?command=deployVirtualMachine&amp;serviceofferingid=1&amp;templateid=204&amp;zoneid=1">http://ip:port/client/api?，CommandString为API命令加参数组成的字符串，详见API文档。例如：http://192.168.1.150:8096/client/api?command=deployVirtualMachine&amp;serviceofferingid=1&amp;templateid=204&amp;zoneid=1</a></p>
<h3 id="12-2-修改Web控制台鼠标指针的方法"><a href="#12-2-修改Web控制台鼠标指针的方法" class="headerlink" title="12.2 修改Web控制台鼠标指针的方法"></a>12.2 修改Web控制台鼠标指针的方法</h3><p>Web控制台的鼠标指针默认是个十字架，若需要修改鼠标指针为默认指针，需登录控制台代理虚拟机修改CSS文件。具体方法如下：</p>
<p>CloudStack的网络不允许从外部登陆系统虚拟机，只能从系统虚拟机所在的主机上登陆，并且ssh的端口号不是22，而是3922。登陆方法：首先在界面查询系统虚拟机所在的主机和link local IP（本例中为169.254.1.175），然后登陆到该host上，使用如下命令进行系统虚拟机登陆：</p>
<p>ssh -i /root/.ssh/id_rsa.cloud -p 3922 <a href="mailto:root@169.254.1.175">root@169.254.1.175</a></p>
<img src="https://images.hnbian.cn/FkLMWQvlBcRbeGmMftW8I4S9zKxw?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" style="zoom:50%;">

<p>查找ajaxviewer.css，输入命令：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">find . –name 'ajaxviewer.css'</span><br><span class="line">./usr/local/cloud/systemvm/css/ajaxviewer.css</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改ajaxviewer.css中的cursor:crosshair;为cursor:default;</span></span><br><span class="line"></span><br><span class="line">.canvas_title{</span><br><span class="line">      cursor:crosshair;</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改为：</span></span><br><span class="line"></span><br><span class="line">.canvas_title{</span><br><span class="line">      cursor:default;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hnbian</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.hnbian.cn/posts/9a4197af.html">https://www.hnbian.cn/posts/9a4197af.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hnbian</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/cloudstack/">
                                    <span class="chip bg-color">cloudstack</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'h1rND3bHC0OqFwzm1UfPQpaY-gzGzoHsz',
        appKey: 'd7uboDt2WLV2HJCEMHkkLuU4',
        serverURLs: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'identicon',
        pageSize: '12',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/a6906361.html">
                    <div class="card-image">
                        
                        <img src="http://images.hnbian.cn//FsS3eY9vxiH4TKZDWgnzBE5RF65m" class="responsive-img" alt="Hive不用UDF实现group concat功能">
                        
                        <span class="card-title">Hive不用UDF实现group concat功能</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2016-02-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/hive/" class="post-category">
                                    hive
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/hive/">
                        <span class="chip bg-color">hive</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/fdea61c2.html">
                    <div class="card-image">
                        
                        <img src="https://images.hnbian.cn/Fowd39fSxvdYO5u74MS0AjVctaYi" class="responsive-img" alt="Hadoop 环境部署文档">
                        
                        <span class="card-title">Hadoop 环境部署文档</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2015-07-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/hadoop/" class="post-category">
                                    hadoop
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/hadoop/">
                        <span class="chip bg-color">hadoop</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: hnbian<br />'
            + '文章作者: hnbian<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2018-2025</span>
            
            <a href="/about" target="_blank">hnbian</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2018";
                        var startMonth = "2";
                        var startDate = "8";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn" target="_blank">粤ICP备18156920号-2</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hnbian" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hnbian@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://www.hnbian.cn"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
