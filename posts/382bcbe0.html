<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Flink系列 3. Flink On Yarn 两种部署模式与提交任务, hnbian">
    <meta name="description" content="1. 介绍Flink 支持多种部署方式 如 Local、Standalone、Yarn、K8S 等，但是现在企业中大多数的大数据平台都以 Yarn 作为资源管理器，所以 Flink On Yarn 模式也在企业中用的非常多，下面就介绍一下F">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155985521-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-155985521-1');
</script>


    <title>Flink系列 3. Flink On Yarn 两种部署模式与提交任务 | hnbian</title>
    <link rel="icon" type="image/png" href="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="hnbian" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">hnbian</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB" class="logo-img circle responsive-img">
        
        <div class="logo-name">hnbian</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hnbian" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hnbian" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://images.hnbian.cn/FvlPa4z9Arlp4GUHEf4C-N__0tlC')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Flink系列 3. Flink On Yarn 两种部署模式与提交任务</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/flink/">
                                <span class="chip bg-color">flink</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/flink/" class="post-category">
                                flink
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-05-01
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h2><p>Flink 支持多种部署方式 如 Local、Standalone、Yarn、K8S 等，但是现在企业中大多数的大数据平台都以 Yarn 作为资源管理器，所以 Flink On Yarn 模式也在企业中用的非常多，下面就介绍一下Flink On Yarn 的使用。</p>
<h2 id="2-Flink-on-yarn任务提交流程图"><a href="#2-Flink-on-yarn任务提交流程图" class="headerlink" title="2. Flink on yarn任务提交流程图"></a>2. Flink on yarn任务提交流程图</h2><p><img src="https://images.hnbian.cn/FpsBU7os7QrGwAqE-8PGJgpxFwOg?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="Flink On Yarn 任务执行流程图"></p>
<h2 id="3-作业提交方式"><a href="#3-作业提交方式" class="headerlink" title="3. 作业提交方式"></a>3. 作业提交方式</h2><p>Flink 作业在yarn上运行有两种提交方式: </p>
<ol>
<li>Session 模式</li>
<li>Per-Job  模式</li>
</ol>
<h3 id="3-1-session-模式"><a href="#3-1-session-模式" class="headerlink" title="3.1 session 模式"></a>3.1 session 模式</h3><p>这种方式需要先启动集群，然后再提交作业, 接着会向yarn申请一块空间, 初始化一个session服务常驻在这块空间, 后续提交的任务都运行在这个session上, 如果session资源使用到达上限则接下来的作业无法提交，只能等待到正在运行的某个作业执行完成,释放了部分资源, 接下来的作业才能正常提交，在session模式下多个 Flink jobmanager 会共享Dispatcher 和 YARN ResourceManager。</p>
<p><img src="https://images.hnbian.cn/FqBLlD_XFUXyFMANKaqnf-HxoGG9?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="yarn-session 提交方式"></p>
<h3 id="3-2-Per-Job-模式"><a href="#3-2-Per-Job-模式" class="headerlink" title="3.2 Per-Job  模式"></a>3.2 Per-Job  模式</h3><p>Per-Job 模式下，每次提交任务都会创建一个新的的 Flink Yarn-session，不同的 Job之间是资源隔离的，不会互相影响，同样Dispatcher和YarnResourceManager也是该任务独享的，任务完成后释放资源。除非是集群资源用尽，否则不会影响新任务的提交。在线上环境一般采用 Per-Job 模式。</p>
<p><img src="https://images.hnbian.cn/FhT5ymkX_2VY3ZVE5eqp65aHKU3V?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="Per-Job  模式"></p>
<h2 id="4-提交任务的准备工作"><a href="#4-提交任务的准备工作" class="headerlink" title="4. 提交任务的准备工作"></a>4. 提交任务的准备工作</h2><p>这里Hadoop 的环境是之前装好的，如果 Hadoop 环境没有装好可以先把所需环境装好。并启动好环境。</p>
<h3 id="4-1-配置-hadoop-classpath"><a href="#4-1-配置-hadoop-classpath" class="headerlink" title="4.1 配置 hadoop classpath"></a>4.1 配置 hadoop classpath</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#在末尾加上 ps HADOOP_HOME 需要提前配置好</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_CLASSPATH=`<span class="variable">${HADOOP_HOME}</span>`/bin hadoop classpath</span><br><span class="line"></span><br><span class="line">[root@node2 ~]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印 hadoop classpath </span></span><br><span class="line">[root@node2 ~]# <span class="built_in">echo</span> <span class="variable">$HADOOP_CLASSPATH</span></span><br><span class="line"><span class="comment"># 如果出现类似下面内容说明配置成功</span></span><br><span class="line">/usr/hdp/3.1.0.0-78/hadoop/conf:/usr/hdp/3.1.0.0-78/hadoop/lib/*:/usr/hdp/3.1.0.0-78/hadoop/.//*:/usr/hdp/3.1.0.0-78/hadoop-hdfs/./:/usr/hdp/3.1.0.0-78/hadoop-hdfs/lib/*:/usr/hdp/3.1.0.0-78/hadoop-hdfs/.//*:/usr/hdp/3.1.0.0-78/hadoop-mapreduce/lib/*:/usr/hdp/3.1.0.0-78/hadoop-......</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-2-上传-Flink-安装包到服务器上"><a href="#4-2-上传-Flink-安装包到服务器上" class="headerlink" title="4.2 上传 Flink 安装包到服务器上"></a>4.2 上传 Flink 安装包到服务器上</h3><p>因为 flink 集群会在 yarn 中创建，这里我们只需要将安装包上传到一台服务器上即可。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传文件并解压（因为之前已经在服务器上安装好 flink 了所以这里就只是演示）</span></span><br><span class="line">scp flink-1.10.2-bin-scala_2.11.tgz  root@node2:/opt</span><br><span class="line">[root@node2 ~]# tar -zxvf flink-1.10.2-bin-scala_2.11.tgz</span><br></pre></td></tr></tbody></table></figure>



<h2 id="5-使用-yarn-session-模式提交任务"><a href="#5-使用-yarn-session-模式提交任务" class="headerlink" title="5.使用 yarn-session 模式提交任务"></a>5.使用 yarn-session 模式提交任务</h2><h3 id="5-1-yarn-session-命令参数说明"><a href="#5-1-yarn-session-命令参数说明" class="headerlink" title="5.1 yarn-session 命令参数说明"></a>5.1 yarn-session 命令参数说明</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压之后进入 binmulu , 使用 -h 查看相关查看参数</span></span><br><span class="line">[root@node2 bin]# ./yarn-session.sh -h</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-at,–applicationType <arg></arg></td>
<td>为YARN上的应用程序设置自定义应用程序类型</td>
</tr>
<tr>
<td>-D &lt;property=value&gt;</td>
<td>设置属性值，动态属性</td>
</tr>
<tr>
<td>-d,–detached</td>
<td>后台运行</td>
</tr>
<tr>
<td>-h,–help</td>
<td>显示帮助</td>
</tr>
<tr>
<td>-id,–applicationId <arg></arg></td>
<td>指定yarn的任务ID；</td>
</tr>
<tr>
<td>-j,–jar <arg></arg></td>
<td>指定 Flink 任务依赖的 jar 包</td>
</tr>
<tr>
<td>-jm,–jobManagerMemory <arg></arg></td>
<td>分配 JobManager 可用内存 (default: MB)</td>
</tr>
<tr>
<td>-m,–jobmanager <arg></arg></td>
<td>要连接的 Master JobManager 的地址。这个参数的优先级会高于配置文件中指定的JobManager地址。</td>
</tr>
<tr>
<td>-nl,–nodeLabel <arg></arg></td>
<td>为YARN应用程序指定YARN节点标签;</td>
</tr>
<tr>
<td>-nm,–name <arg></arg></td>
<td>YARN上为一个自定义的应用设置一个名字，在 yarnUI 上的名字</td>
</tr>
<tr>
<td>-q,–query</td>
<td>显示yarn中可用的资源 (内存, cpu核数)</td>
</tr>
<tr>
<td>-qu,–queue <arg></arg></td>
<td>指定队列</td>
</tr>
<tr>
<td>-s,–slots <arg></arg></td>
<td>指定每一个taskmanager分配多少个slots(处理进程)。<br>建议设置为每个机器的CPU核数。一般情况下，vcore的数量等于处理的slot（-s）的数量</td>
</tr>
<tr>
<td>-t,–ship <arg></arg></td>
<td>Ship files in the specified directory (t for transfer)</td>
</tr>
<tr>
<td>-tm,–taskManagerMemory <arg></arg></td>
<td>TaskManager 可用内存 (default: MB)</td>
</tr>
<tr>
<td>-yd,–yarndetached</td>
<td>If present, runs the job in detached mode (deprecated; use non-YARN specific option instead)</td>
</tr>
<tr>
<td>-z,–zookeeperNamespace <arg></arg></td>
<td>命名空间，用于为高可用性模式创建Zookeeper子路径</td>
</tr>
</tbody></table>
<h3 id="5-2-启动-yarn-session"><a href="#5-2-启动-yarn-session" class="headerlink" title="5.2 启动 yarn-session"></a>5.2 启动 yarn-session</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 bin]$ ./yarn-session.sh  -jm 1024m -tm 1024m -d <span class="comment"># 如果想后台运行请添加 -d 命令</span></span><br><span class="line">Setting HADOOP_CONF_DIR=/etc/hadoop/conf because no HADOOP_CONF_DIR was <span class="built_in">set</span>.</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/opt/flink-1.10.2/lib/slf4j-log4j12-1.7.15.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/usr/hdp/3.1.0.0-78/hadoop/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings <span class="keyword">for</span> an explanation.</span><br><span class="line">SLF4J: Actual binding is of <span class="built_in">type</span> [org.slf4j.impl.Log4jLoggerFactory]</span><br><span class="line">2020-12-25 09:48:04,782 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.address, localhost</span><br><span class="line">2020-12-25 09:48:04,788 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.port, 6123</span><br><span class="line">2020-12-25 09:48:04,788 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.heap.size, 1024m</span><br><span class="line">2020-12-25 09:48:04,789 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.memory.process.size, 1728m</span><br><span class="line">2020-12-25 09:48:04,789 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.numberOfTaskSlots, 1</span><br><span class="line">2020-12-25 09:48:04,789 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: parallelism.default, 1</span><br><span class="line">2020-12-25 09:48:04,790 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.execution.failover-strategy, region</span><br><span class="line">2020-12-25 09:48:05,221 WARN  org.apache.flink.runtime.util.HadoopUtils                     - Could not find Hadoop configuration via any of the supported methods (Flink configuration, environment variables).</span><br><span class="line">2020-12-25 09:48:05,919 WARN  org.apache.hadoop.util.NativeCodeLoader                       - Unable to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes <span class="built_in">where</span> applicable</span><br><span class="line">2020-12-25 09:48:06,169 INFO  org.apache.flink.runtime.security.modules.HadoopModule        - Hadoop user <span class="built_in">set</span> to hdfs (auth:SIMPLE)</span><br><span class="line">2020-12-25 09:48:06,270 INFO  org.apache.flink.runtime.security.modules.JaasModule          - Jaas file will be created as /tmp/jaas-4713104554052783620.conf.</span><br><span class="line">2020-12-25 09:48:06,302 WARN  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The configuration directory (<span class="string">'/opt/flink-1.10.2/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">2020-12-25 09:48:06,938 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at node1/192.168.0.39:8050</span><br><span class="line">2020-12-25 09:48:07,698 INFO  org.apache.hadoop.yarn.client.AHSProxy                        - Connecting to Application History server at node2/192.168.0.38:10200</span><br><span class="line">2020-12-25 09:48:07,818 INFO  org.apache.flink.runtime.clusterframework.TaskExecutorProcessUtils  - The derived from fraction jvm overhead memory (172.800mb (181193935 bytes)) is less than its min value 192.000mb (201326592 bytes), min value will be used instead</span><br><span class="line">2020-12-25 09:48:08,236 INFO  org.apache.hadoop.conf.Configuration                          - found resource resource-types.xml at file:/etc/hadoop/3.1.0.0-78/0/resource-types.xml</span><br><span class="line">2020-12-25 09:48:08,304 WARN  org.apache.flink.yarn.YarnClusterDescriptor                   - Neither the HADOOP_CONF_DIR nor the YARN_CONF_DIR environment variable is <span class="built_in">set</span>. The Flink YARN Client needs one of these to be <span class="built_in">set</span> to properly load the Hadoop configuration <span class="keyword">for</span> accessing YARN.</span><br><span class="line">2020-12-25 09:48:08,387 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Cluster specification: ClusterSpecification{masterMemoryMB=1024, taskManagerMemoryMB=1728, slotsPerTaskManager=1}</span><br><span class="line">2020-12-25 09:48:10,050 WARN  org.apache.hadoop.hdfs.shortcircuit.DomainSocketFactory       - The short-circuit <span class="built_in">local</span> reads feature cannot be used because libhadoop cannot be loaded.</span><br><span class="line">2020-12-25 09:48:16,189 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Submitting application master <span class="string">'application_1608705158439_0045'</span> <span class="comment"># yarn 上的 ApplicationID</span></span><br><span class="line">2020-12-25 09:48:17,420 INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl         - Submitted application application_1608705158439_0045</span><br><span class="line">2020-12-25 09:48:17,420 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Waiting <span class="keyword">for</span> the cluster to be allocated</span><br><span class="line">2020-12-25 09:48:17,422 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Deploying cluster, current state ACCEPTED</span><br><span class="line">2020-12-25 09:48:28,235 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - YARN application has been deployed successfully.</span><br><span class="line">2020-12-25 09:48:28,267 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Found Web Interface node3:37719 of application <span class="string">'application_1608705158439_0045'</span>.</span><br><span class="line">JobManager Web Interface: <span class="string">'http://node3:37719'</span> <span class="comment"># 通过这个地址可以访问 flibk webUI页面</span></span><br></pre></td></tr></tbody></table></figure>



<ul>
<li>查看 yarn 上的 Application</li>
</ul>
<p><img src="https://images.hnbian.cn/FkoZXpgs271hYWj9WaIDIYqe2aQ_?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="yarn-session"></p>
<ul>
<li>查看 Flink webUI  <a target="_blank" rel="noopener" href="http://node3:37719/">http://node3:37719</a></li>
</ul>
<p><img src="https://images.hnbian.cn/Fghpw0HNxBMXQKmf27R-sGL7QZbK?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="Flink webUI"></p>
<h3 id="5-3-提交测试任务"><a href="#5-3-提交测试任务" class="headerlink" title="5.3 提交测试任务"></a>5.3 提交测试任务</h3><ul>
<li>在 yarn 中启动的 Flink 集群的 ApplicationID 会被保存到 /tmp/.yarn-properties-hdfs 文件中，当向 yarn 中的 flink 集群提交任务时，Flink 程序会先查找该文件内的 ApplicationID.</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hdfs@node2 bin]$ <span class="built_in">cat</span> /tmp/.yarn-properties-hdfs</span><br><span class="line"><span class="comment">#Generated YARN properties file</span></span><br><span class="line"><span class="comment">#Fri Dec 25 09:48:19 CST 2020</span></span><br><span class="line">dynamicPropertiesString=</span><br><span class="line">applicationID=application_1608705158439_0045</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>提交任务</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[hdfs@node2 flink-1.10.2]$ bin/flink run ./examples/batch/WordCount.jar <span class="comment"># 提交 flink 自带的测试任务</span></span><br><span class="line">Setting HADOOP_CONF_DIR=/etc/hadoop/conf because no HADOOP_CONF_DIR was <span class="built_in">set</span>.</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/opt/flink-1.10.2/lib/slf4j-log4j12-1.7.15.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/usr/hdp/3.1.0.0-78/hadoop/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings <span class="keyword">for</span> an explanation.</span><br><span class="line">SLF4J: Actual binding is of <span class="built_in">type</span> [org.slf4j.impl.Log4jLoggerFactory]</span><br><span class="line">2020-12-25 10:24:38,016 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-hdfs.</span><br><span class="line">2020-12-25 10:24:38,016 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-hdfs.</span><br><span class="line">2020-12-25 10:24:38,582 WARN  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The configuration directory (<span class="string">'/opt/flink-1.10.2/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">2020-12-25 10:24:38,582 WARN  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The configuration directory (<span class="string">'/opt/flink-1.10.2/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">Executing WordCount example with default input data <span class="built_in">set</span>.</span><br><span class="line">Use --input to specify file input.</span><br><span class="line">Printing result to stdout. Use --output to specify output path.</span><br><span class="line">2020-12-25 10:24:40,254 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at node1/192.168.0.39:8050</span><br><span class="line">2020-12-25 10:24:41,203 INFO  org.apache.hadoop.yarn.client.AHSProxy                        - Connecting to Application History server at node2/192.168.0.38:10200</span><br><span class="line">2020-12-25 10:24:41,231 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - No path <span class="keyword">for</span> the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-12-25 10:24:41,240 WARN  org.apache.flink.yarn.YarnClusterDescriptor                   - Neither the HADOOP_CONF_DIR nor the YARN_CONF_DIR environment variable is set.The Flink YARN Client needs one of these to be <span class="built_in">set</span> to properly load the Hadoop configuration <span class="keyword">for</span> accessing YARN.</span><br><span class="line">2020-12-25 10:24:41,573 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Found Web Interface node2:44910 of application <span class="string">'application_1608705158439_0048'</span>.</span><br><span class="line">Job has been submitted with JobID c79faee9ef1dbdb1400641c1f65fc825</span><br><span class="line">Program execution finished</span><br><span class="line">Job with JobID c79faee9ef1dbdb1400641c1f65fc825 has finished.</span><br><span class="line">Job Runtime: 26236 ms</span><br><span class="line">Accumulator Results:</span><br><span class="line">- abe323736302b8ad21edede0d34582be (java.util.ArrayList) [170 elements]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">(a,5)</span><br><span class="line">(action,1)</span><br><span class="line">(after,1)</span><br><span class="line">(against,1)</span><br><span class="line">(all,2)</span><br><span class="line">(and,12)</span><br><span class="line">(arms,1)</span><br><span class="line">(arrows,1)</span><br><span class="line">(awry,1)</span><br><span class="line">(ay,1)</span><br><span class="line">(bare,1)</span><br><span class="line">(be,4)</span><br><span class="line">(bear,3)</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>查看 Flink webUI 中的任务情况</li>
</ul>
<p><img src="https://images.hnbian.cn/FisyxUz1XvX9YPflTVmZ0nYyfD2O?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="提交任务之后马上进Flink webUI 能看到 Wordcount 任务正在运行"></p>
<p><img src="https://images.hnbian.cn/FsVdDr-EvUFnt1KVkDu_bEeXwTq_?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="查看任务运行流程"></p>
<h3 id="5-4-关闭-yarn-上的-flink-集群"><a href="#5-4-关闭-yarn-上的-flink-集群" class="headerlink" title="5.4 关闭 yarn 上的 flink 集群"></a>5.4 关闭 yarn 上的 flink 集群</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hdfs@node2 flink-1.10.2]$ yarn application -<span class="built_in">kill</span> application_1608705158439_0048</span><br><span class="line">20/12/25 10:33:52 INFO client.RMProxy: Connecting to ResourceManager at node1/192.168.0.39:8050</span><br><span class="line">20/12/25 10:33:53 INFO client.AHSProxy: Connecting to Application History server at node2/192.168.0.38:10200</span><br><span class="line">Killing application application_1608705158439_0045</span><br><span class="line">20/12/25 10:33:53 INFO impl.YarnClientImpl: Killed application application_1608705158439_0045</span><br></pre></td></tr></tbody></table></figure>



<h2 id="6-使用-Per-Job-模式-提交任务"><a href="#6-使用-Per-Job-模式-提交任务" class="headerlink" title="6.使用 Per-Job  模式 提交任务"></a>6.使用 Per-Job  模式 提交任务</h2><p>对于Per-Job模式，提交作业就相对比较简单，不需要提前在yarn 中启动一个 Flink 集群，而是直接提交作业，即可完成Flink作业。</p>
<p>使用 Flink run -m yarn-cluster 命令（创建 Flink 集群并提交任务）</p>
<h3 id="6-1-参数说明"><a href="#6-1-参数说明" class="headerlink" title="6.1 参数说明"></a>6.1 参数说明</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看参数与相关说明</span></span><br><span class="line">[root@node2 bin]# ./flink run -<span class="built_in">help</span></span><br></pre></td></tr></tbody></table></figure>



<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-c,–class <classname></classname></td>
<td>动态指定 jar包的入口类</td>
</tr>
<tr>
<td>-C,–classpath <url></url></td>
<td>Adds a URL to each user code classloader  on all nodes in the cluster. The paths must specify a protocol (e.g. file://) and be accessible on all nodes (e.g. by means of a NFS share). You can use this option multiple times for specifying more than one URL. The protocol must be supported by the {@link java.net.URLClassLoader}.</td>
</tr>
<tr>
<td>-d,–detached</td>
<td>后台运行</td>
</tr>
<tr>
<td>-n,–allowNonRestoredState</td>
<td>允许跳过无法还原的保存点状态。如果在触发保存点时从程序中删除了一部分运算符，则需要允许此操作。</td>
</tr>
<tr>
<td>-p,–parallelism <parallelism></parallelism></td>
<td>动态指定程序的并行度，优先级高于配置文件中的默认值</td>
</tr>
<tr>
<td>-py,–python <pythonfile></pythonfile></td>
<td>带有程序入口点的Python脚本。该相关资源可以用’–pyFiles`选项进行配置。</td>
</tr>
<tr>
<td>-pyarch,–pyArchives <arg></arg></td>
<td>Add python archive files for job. The archive files will be extracted to the working directory of python UDF worker. Currently only zip-format is supported. For each archive file, a target directory be specified. If the target directory name is specified, the archive file will be extracted to a name can directory with the specified name. Otherwise, the archive file will be extracted to a directory with the same name of the archive file. The files uploaded via this option are accessible via relative path. ‘#’ could be used as the separator of the archive file path and the target directory name. Comma (‘,’) could be used as the separator to specify multiple archive files. This option can be used to upload the virtual environment, the data files used in Python UDF (e.g.: –pyArchives file:///tmp/py37.zip,file:///tmp/data. zip#data –pyExecutable py37.zip/py37/bin/python). The data files could be accessed in Python UDF, e.g.: f = open(‘data/data.txt’, ‘r’).</td>
</tr>
<tr>
<td>-pyexec,–pyExecutable <arg></arg></td>
<td>Specify the path of the python interpreter used to execute the python UDF worker (e.g.: –pyExecutable /usr/local/bin/python3). The python UDF worker depends on Python 3.5+, Apache Beam (version == 2.15.0), Pip (version &gt;= 7.1.0) and SetupTools (version &gt;= 37.0.0). Please ensure that the specified environment meets the above requirements.</td>
</tr>
<tr>
<td>-pyfs,–pyFiles <pythonfiles></pythonfiles></td>
<td>Attach custom python files for job. These files will be added to the PYTHONPATH of both the local client and the remote python UDF worker. The standard python resource file suffixes such as .py/.egg/.zip or directory are all supported. Comma (‘,’) could be used as the separator to specify multiple files (e.g.: –pyFiles file:///tmp/myresource.zip,hdfs:///$na menode_address/myresource2.zip).</td>
</tr>
<tr>
<td>-pym,–pyModule <pythonmodule></pythonmodule></td>
<td>Python模块与程序的入口点。 此选项必须与–pyFiles 结合使用。</td>
</tr>
<tr>
<td>-pyreq,–pyRequirements <arg></arg></td>
<td>Specify a requirements.txt file which defines the third-party dependencies. These dependencies will be installed and added to the PYTHONPATH of the python UDF worker. A directory which contains the installation packages of these dependencies could be specified optionally. Use ‘#’ as the separator if the optional parameter exists (e.g.: –pyRequirements file:///tmp/requirements.txt#file:///t mp/cached_dir).</td>
</tr>
<tr>
<td>-s,–fromSavepoint <savepointpath></savepointpath></td>
<td>job 存储保存点的位置  (如： hdfs:///flink/savepoint-1537).</td>
</tr>
<tr>
<td>-sae,–shutdownOnAttachedExit</td>
<td>如果作业以附加模式提交，请在CLI突然终止时（例如，响应用户中断，例如键入Ctrl + C），尽最大努力关闭集群。</td>
</tr>
</tbody></table>
<ul>
<li>Yarn-cluster 模式中的可选参数</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-m,–jobmanager <arg></arg></td>
<td>动态指定 JobManager 主节点地址</td>
</tr>
<tr>
<td>-yid,–yarnapplicationId <arg></arg></td>
<td>指定yarn的任务ID；</td>
</tr>
<tr>
<td>-z,–zookeeperNamespace <arg></arg></td>
<td>命名空间，用于为高可用性模式创建Zookeeper子路径;</td>
</tr>
</tbody></table>
<ul>
<li>默认模式可选参数</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-m,–jobmanager <arg></arg></td>
<td>要连接的 Master JobManager 的地址。这个参数的优先级会高于配置文件中指定的JobManager地址。</td>
</tr>
<tr>
<td>-z,–zookeeperNamespace <arg></arg></td>
<td>命名空间，用于为高可用性模式创建Zookeeper子路径</td>
</tr>
</tbody></table>
<h3 id="6-2-提交任务"><a href="#6-2-提交任务" class="headerlink" title="6.2 提交任务"></a>6.2 提交任务</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[hdfs@node2 flink-1.10.2]$ ./bin/flink run -m yarn-cluster ./examples/batch/WordCount.jar</span><br><span class="line">Setting HADOOP_CONF_DIR=/etc/hadoop/conf because no HADOOP_CONF_DIR was <span class="built_in">set</span>.</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/opt/flink-1.10.2/lib/slf4j-log4j12-1.7.15.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/usr/hdp/3.1.0.0-78/hadoop/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings <span class="keyword">for</span> an explanation.</span><br><span class="line">SLF4J: Actual binding is of <span class="built_in">type</span> [org.slf4j.impl.Log4jLoggerFactory]</span><br><span class="line">2020-12-25 10:49:01,986 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-hdfs.</span><br><span class="line">2020-12-25 10:49:01,986 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-hdfs.</span><br><span class="line">2020-12-25 10:49:02,457 WARN  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The configuration directory (<span class="string">'/opt/flink-1.10.2/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">2020-12-25 10:49:02,457 WARN  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The configuration directory (<span class="string">'/opt/flink-1.10.2/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">Executing WordCount example with default input data <span class="built_in">set</span>.</span><br><span class="line">Use --input to specify file input.</span><br><span class="line">Printing result to stdout. Use --output to specify output path.</span><br><span class="line">2020-12-25 10:49:03,717 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at node1/192.168.0.39:8050</span><br><span class="line">2020-12-25 10:49:04,377 INFO  org.apache.hadoop.yarn.client.AHSProxy                        - Connecting to Application History server at node2/192.168.0.38:10200</span><br><span class="line">2020-12-25 10:49:04,423 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - No path <span class="keyword">for</span> the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-12-25 10:49:04,809 INFO  org.apache.hadoop.conf.Configuration                          - found resource resource-types.xml at file:/etc/hadoop/3.1.0.0-78/0/resource-types.xml</span><br><span class="line">2020-12-25 10:49:04,891 WARN  org.apache.flink.yarn.YarnClusterDescriptor                   - Neither the HADOOP_CONF_DIR nor the YARN_CONF_DIR environment variable is <span class="built_in">set</span>. The Flink YARN Client needs one of these to be <span class="built_in">set</span> to properly load the Hadoop configuration <span class="keyword">for</span> accessing YARN.</span><br><span class="line">2020-12-25 10:49:05,071 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Cluster specification: ClusterSpecification{masterMemoryMB=1024, taskManagerMemoryMB=1728, slotsPerTaskManager=1}</span><br><span class="line">2020-12-25 10:49:07,172 WARN  org.apache.hadoop.hdfs.shortcircuit.DomainSocketFactory       - The short-circuit <span class="built_in">local</span> reads feature cannot be used because libhadoop cannot be loaded.</span><br><span class="line">2020-12-25 10:49:12,476 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Submitting application master application_1608705158439_0049</span><br><span class="line">2020-12-25 10:49:12,774 INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl         - Submitted application application_1608705158439_0049</span><br><span class="line">2020-12-25 10:49:12,775 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Waiting <span class="keyword">for</span> the cluster to be allocated</span><br><span class="line">2020-12-25 10:49:12,777 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Deploying cluster, current state ACCEPTED</span><br><span class="line">2020-12-25 10:49:19,073 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - YARN application has been deployed successfully.</span><br><span class="line">2020-12-25 10:49:19,074 INFO  org.apache.flink.yarn.YarnClusterDescriptor                   - Found Web Interface node3:35416 of application <span class="string">'application_1608705158439_0049'</span>.</span><br><span class="line">Job has been submitted with JobID 505a14cbbf0cca7cad029ed90fe048eb</span><br><span class="line">Program execution finished</span><br><span class="line">Job with JobID 505a14cbbf0cca7cad029ed90fe048eb has finished.</span><br><span class="line">Job Runtime: 10932 ms</span><br><span class="line">Accumulator Results:</span><br><span class="line">- 7fbe82214da97e7cbb5a60d0890bdbdb (java.util.ArrayList) [170 elements]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(a,5)</span><br><span class="line">(action,1)</span><br><span class="line">(after,1)</span><br><span class="line">(against,1)</span><br><span class="line">(all,2)</span><br><span class="line">(and,12)</span><br><span class="line">(arms,1)</span><br><span class="line">(arrows,1)</span><br><span class="line">(awry,1)</span><br><span class="line">(ay,1)</span><br><span class="line">(bare,1)</span><br><span class="line">(be,4)</span><br><span class="line">(bear,3)</span><br><span class="line">(bodkin,1)</span><br><span class="line">(bourn,1)</span><br><span class="line">(but,1)</span><br></pre></td></tr></tbody></table></figure>



<ul>
<li>查看 yarn 中的 application</li>
</ul>
<p><img src="https://images.hnbian.cn/FpSHsKL4SB9N3XFbeTF-ATeP634m?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="任务还在等待状态"></p>
<p><img src="https://images.hnbian.cn/FmofaPh0_yEM3nFLLJTboNb2aZrb?imageView2/0/interlace/1/q/70%7Cwatermark/2/text/d3d3LmhuYmlhbi5jbg==/font/5b6u6L2v6ZuF6buR/fontsize/600/fill/IzBDMjU2NA==/dissolve/100/gravity/SouthEast/dx/10/dy/10%7Cimageslim" alt="任务执行完成"></p>
<h3 id="6-3-其他提交命令"><a href="#6-3-其他提交命令" class="headerlink" title="6.3 其他提交命令"></a>6.3 其他提交命令</h3><ul>
<li>连接指定 host 和 port 的 JobManager（已知一个 Flink 集群，并把任务提交到该集群）：</li>
</ul>
<p>bin/flink run -m node1:9999 ./examples/bath/WordCount.jar</p>
<ul>
<li>启动一个新的 yarn-session 并提交任务</li>
</ul>
<p>bin/flink run -m yarn-cluster -yn 2 ./examples/bath/WordCount.jar</p>
<ul>
<li>注意：bin/flink 可以使用 yarn-session.sh 中的命令，需要添加一个 y 前缀</li>
</ul>
<p>例如：bin/flink run -m yarn-cluster -yjm 1024 -ytm 1024 ./examples/bath/WordCount.jar</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hnbian</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.hnbian.cn/posts/382bcbe0.html">https://www.hnbian.cn/posts/382bcbe0.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hnbian</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/flink/">
                                    <span class="chip bg-color">flink</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'h1rND3bHC0OqFwzm1UfPQpaY-gzGzoHsz',
        appKey: 'd7uboDt2WLV2HJCEMHkkLuU4',
        serverURLs: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'identicon',
        pageSize: '12',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/ad82a2c1.html">
                    <div class="card-image">
                        
                        <img src="https://images.hnbian.cn/FvVRbRIIdLGQxrQfcHcHGeyeTPOf" class="responsive-img" alt="GreenPlum 6.7 集群部署">
                        
                        <span class="card-title">GreenPlum 6.7 集群部署</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-05-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/greenplum/" class="post-category">
                                    greenplum
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/greenplum/">
                        <span class="chip bg-color">greenplum</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/56a1d2a4.html">
                    <div class="card-image">
                        
                        <img src="https://images.hnbian.cn/Fr_E06S6zB220ttJtjscq5SeCgfO" class="responsive-img" alt="Flink系列 2. standalone 模式部署与任务提交">
                        
                        <span class="card-title">Flink系列 2. standalone 模式部署与任务提交</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-04-29
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/flink/" class="post-category">
                                    flink
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/flink/">
                        <span class="chip bg-color">flink</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: hnbian<br />'
            + '文章作者: hnbian<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2018-2025</span>
            
            <a href="/about" target="_blank">hnbian</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2018";
                        var startMonth = "2";
                        var startDate = "8";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn" target="_blank">粤ICP备18156920号-2</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hnbian" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hnbian@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://www.hnbian.cn"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
